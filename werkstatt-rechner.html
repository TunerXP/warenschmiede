<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warenschmiede Metall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e2e', 900: '#0f172a' },
                        metal: { 500: '#64748b', 600: '#475569' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        
        .input-group label {
            display: flex; align-items: center; gap: 4px;
            font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; margin-bottom: 0.25rem;
        }
        .input-field {
            width: 100%; background-color: #1e293b; border: 1px solid #334155; color: white;
            padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; font-size: 1rem;
            transition: all 0.2s;
        }
        .input-field:focus { outline: none; border-color: #f59e0b; box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2); }
        .input-error { border-color: #ef4444; background-color: #450a0a; }
        
        /* Tooltip Style */
        .tooltip { position: relative; display: inline-flex; cursor: help; align-items: center; }
        .tooltip .tooltiptext {
            visibility: hidden; width: 220px; background-color: #0f172a; color: #cbd5e1; text-align: left;
            border-radius: 6px; padding: 10px; position: absolute; z-index: 50; bottom: 135%; left: 50%;
            margin-left: -110px; opacity: 0; transition: opacity 0.3s; border: 1px solid #475569;
            font-size: 0.75rem; font-weight: normal; text-transform: none; line-height: 1.4;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); pointer-events: none;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .tooltip .tooltiptext::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #475569 transparent transparent transparent;
        }

        .tab-content { display: none; animation: fadeIn 0.2s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .result-box {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
        }
        
        .nav-btn { white-space: nowrap; }
        .nav-btn.active { color: #f97316; border-bottom-color: #f97316; } /* Orange-500 */
    </style>
</head>
<body class="bg-slate-900 text-slate-200 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700 h-16 shrink-0 flex items-center justify-between px-4 z-20 shadow-lg">
        <div class="flex items-center gap-3">
            <div class="bg-gradient-to-br from-amber-600 to-orange-700 p-2 rounded-lg text-white shadow-lg shadow-orange-500/20">
                <i class="ph ph-wrench text-xl"></i>
            </div>
            <div>
                <h1 class="font-bold tracking-wide text-lg leading-tight text-white">Warenschmiede <span class="text-orange-500 italic">METALL</span></h1>
                <p class="text-[10px] text-slate-400">CNC & Fertigungstechnik</p>
            </div>
        </div>
        <a href="https://www.warenschmiede.com/" target="_blank" class="text-xs text-slate-400 hover:text-white transition flex items-center gap-1">
            <i class="ph ph-house"></i> Home
        </a>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-slate-800/50 border-b border-slate-700 overflow-x-auto">
        <div class="flex px-2 min-w-max">
            <button onclick="switchTab('schnitt')" class="nav-btn active flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-aperture"></i> Schnittdaten
            </button>
            <button onclick="switchTab('toleranzen')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-ruler"></i> Toleranzen ISO 2768
            </button>
            <button onclick="switchTab('iso')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-ruler-precision"></i> ISO-Passungen
            </button>
            <button onclick="switchTab('gewinde')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-screw"></i> Gewinde & Kernlöcher
            </button>
            <button onclick="switchTab('schrauben')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-nut"></i> Schrauben & Senkungen
            </button>
            <button onclick="switchTab('einheiten')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-arrows-left-right"></i> Einheiten & Umrechner
            </button>
            <button onclick="switchTab('gewicht')" class="nav-btn flex items-center gap-2 px-4 py-3 text-sm font-bold text-slate-400 hover:text-white border-b-2 border-transparent transition-colors">
                <i class="ph ph-scales"></i> Material & Gewicht
            </button>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto p-4 sm:p-6 relative max-w-5xl mx-auto w-full">

        <!-- TAB 1: SCHNITTDATEN -->
        <div id="tab-schnitt" class="tab-content active">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Schnittdaten-Rechner</h2>
                <p class="text-sm text-slate-400">Hier berechnest du Drehzahl, Vorschub und Zeitspanvolumen. Wähle einfach dein Material und Werkzeug.</p>
            </div>

            <!-- Presets -->
            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-6 shadow-md">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                    <div class="input-group">
                        <label>Material</label>
                        <select id="cut-mat" class="input-field text-sm cursor-pointer">
                            <option value="steel">Stahl (allgemein)</option>
                            <option value="inox">Edelstahl (VA)</option>
                            <option value="alu">Aluminium</option>
                            <option value="plastic">Kunststoff</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Bearbeitung</label>
                        <select id="cut-op" class="input-field text-sm cursor-pointer">
                            <option value="drill">Bohren (HSS/VHM)</option>
                            <option value="mill_rough">Fräsen (Schruppen)</option>
                            <option value="mill_finish">Fräsen (Schlichten)</option>
                        </select>
                    </div>
                    <button onclick="loadCuttingPresets()" class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 px-4 rounded-lg transition text-sm flex items-center justify-center gap-2 shadow-lg hover:shadow-orange-500/20">
                        <i class="ph ph-lightning"></i> Richtwerte laden
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Inputs -->
                <div class="space-y-4">
                    <div class="input-group">
                        <label>Werkzeug-Ø d [mm]</label>
                        <input type="number" id="inp-d" class="input-field" value="10" min="0.1" oninput="calcSchnitt()">
                    </div>

                    <div class="input-group">
                        <label>
                            Schnittgeschw. vc [m/min]
                            <span class="tooltip"><i class="ph ph-info text-orange-500 ml-1"></i>
                                <span class="tooltiptext">Die Geschwindigkeit, mit der die Schneide am Werkstück entlangfährt.</span>
                            </span>
                        </label>
                        <input type="number" id="inp-vc" class="input-field" value="120" oninput="calcSchnitt()">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group">
                            <label>Zähnezahl z</label>
                            <input type="number" id="inp-z" class="input-field" value="4" min="1" oninput="calcSchnitt()">
                        </div>
                        <div class="input-group">
                            <label>
                                Vorschub/Zahn fz [mm]
                                <span class="tooltip"><i class="ph ph-info text-orange-500 ml-1"></i>
                                    <span class="tooltiptext">Weg, den das Werkzeug pro Zahn vorankommt.</span>
                                </span>
                            </label>
                            <input type="number" id="inp-fz" class="input-field" value="0.05" oninput="calcSchnitt()">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 pt-2 border-t border-slate-700">
                        <div class="input-group">
                            <label>Schnitttiefe ap [mm]</label>
                            <input type="number" id="inp-ap" class="input-field text-slate-400 placeholder-slate-600" placeholder="Optional" oninput="calcSchnitt()">
                        </div>
                        <div class="input-group">
                            <label>Schnittbreite ae [mm]</label>
                            <input type="number" id="inp-ae" class="input-field text-slate-400 placeholder-slate-600" placeholder="Optional" oninput="calcSchnitt()">
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="flex flex-col gap-4">
                    <div class="result-box p-6 rounded-2xl shadow-xl flex-1 flex flex-col justify-center items-center text-center relative overflow-hidden group">
                        <span class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">Drehzahl (n)</span>
                        <div id="res-n" class="text-5xl font-mono font-bold text-orange-500 group-hover:scale-105 transition-transform">3820</div>
                        <div class="text-slate-500 text-sm mt-1">U/min</div>
                        <div id="rpm-warning" class="hidden absolute bottom-2 bg-red-900/90 text-red-200 text-[10px] px-3 py-1 rounded-full border border-red-700 animate-pulse font-bold flex items-center gap-1">
                            <i class="ph ph-warning"></i> Sehr hoch! Maschine prüfen.
                        </div>
                    </div>
                    
                    <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-slate-400 uppercase font-bold">Vorschubgeschw. (vf)</span>
                            <span class="text-xl font-mono font-bold text-white"><span id="res-vf">764</span> <span class="text-sm font-normal text-slate-500">mm/min</span></span>
                        </div>
                        <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-blue-500 h-full w-2/3 opacity-50"></div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400 uppercase font-bold">Zeitspanvolumen (Q)</span>
                            <span class="text-lg font-mono font-bold text-slate-300"><span id="res-q">--</span> <span class="text-xs font-normal text-slate-500">cm³/min</span></span>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-500 text-center mt-2 italic">Hinweis: Alle Werte sind Richtwerte. Beachte immer die Angaben der Hersteller.</p>
                </div>
            </div>
        </div>

        <!-- TAB 2: TOLERANZEN ISO 2768 -->
        <div id="tab-toleranzen" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Allgemeintoleranzen nach DIN ISO 2768-1</h2>
                <p class="text-sm text-slate-400">Gültig für lineare Maße, wenn auf der Zeichnung kein spezielles Toleranzfeld angegeben ist.</p>
            </div>

            <!-- Mini Rechner -->
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 max-w-2xl mx-auto mb-8 shadow-lg">
                <h3 class="font-bold text-slate-200 mb-4 flex items-center gap-2"><i class="ph ph-calculator text-blue-400"></i> Toleranz-Check</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div class="input-group">
                        <label>Nennmaß in mm</label>
                        <input type="number" id="tol2768-dim" class="input-field" placeholder="z.B. 45" oninput="calcToleranz2768()">
                    </div>
                    <div class="input-group">
                        <label>Toleranzklasse</label>
                        <select id="tol2768-class" class="input-field cursor-pointer" onchange="calcToleranz2768()">
                            <option value="f">fein (f)</option>
                            <option value="m" selected>mittel (m) - Standard</option>
                            <option value="c">grob (c)</option>
                        </select>
                    </div>
                </div>
                
                <div id="tol2768-res" class="bg-slate-900 p-4 rounded-lg border border-slate-600 text-center hidden transition-all">
                    <div class="text-sm text-slate-400 uppercase tracking-wide text-[10px] mb-1">Ergebnis</div>
                    <div class="text-2xl font-bold text-white mb-1">±<span id="tol2768-val">0.3</span> mm</div>
                    <div class="text-sm font-mono text-blue-400">Bereich: <span id="tol2768-range">44.70 - 45.30</span> mm</div>
                </div>
                <div id="tol2768-error" class="hidden text-red-400 text-xs text-center mt-2">Dieses Tool deckt Nennmaße von 0,5 mm bis 2000 mm ab.</div>
            </div>

            <!-- Tabelle -->
            <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden shadow-lg opacity-90 hover:opacity-100 transition-opacity">
                <div class="overflow-x-auto">
                    <table class="w-full text-xs text-left">
                        <thead class="text-slate-400 bg-slate-950 uppercase font-bold">
                            <tr>
                                <th class="p-3">Nennmaßbereich</th>
                                <th class="p-3 text-center text-green-400 border-l border-slate-800">fein (f)</th>
                                <th class="p-3 text-center text-blue-400 border-l border-slate-800">mittel (m)</th>
                                <th class="p-3 text-center text-yellow-400 border-l border-slate-800">grob (c)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700 text-slate-300 font-mono">
                            <tr class="hover:bg-slate-700/50"><td class="p-3">0.5 bis 3</td><td class="text-center border-l border-slate-700">±0.05</td><td class="text-center border-l border-slate-700">±0.1</td><td class="text-center border-l border-slate-700">±0.2</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 3 bis 6</td><td class="text-center border-l border-slate-700">±0.05</td><td class="text-center border-l border-slate-700">±0.1</td><td class="text-center border-l border-slate-700">±0.3</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 6 bis 30</td><td class="text-center border-l border-slate-700">±0.1</td><td class="text-center border-l border-slate-700">±0.2</td><td class="text-center border-l border-slate-700">±0.5</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 30 bis 120</td><td class="text-center border-l border-slate-700">±0.15</td><td class="text-center border-l border-slate-700">±0.3</td><td class="text-center border-l border-slate-700">±0.8</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 120 bis 400</td><td class="text-center border-l border-slate-700">±0.2</td><td class="text-center border-l border-slate-700">±0.5</td><td class="text-center border-l border-slate-700">±1.2</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 400 bis 1000</td><td class="text-center border-l border-slate-700">±0.3</td><td class="text-center border-l border-slate-700">±0.8</td><td class="text-center border-l border-slate-700">±2.0</td></tr>
                            <tr class="hover:bg-slate-700/50"><td class="p-3">über 1000 bis 2000</td><td class="text-center border-l border-slate-700">±0.5</td><td class="text-center border-l border-slate-700">±1.2</td><td class="text-center border-l border-slate-700">±3.0</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="p-3 bg-slate-900/50 text-[10px] text-slate-500 border-t border-slate-700">
                    <i class="ph ph-info mr-1"></i> Diese Werte gelten nur für Längenmaße ohne eigene Toleranzangabe. Form-, Lage- und Oberflächentoleranzen müssen separat definiert werden.
                </div>
            </div>
        </div>

        <!-- TAB 3: ISO PASSUNGEN -->
        <div id="tab-iso" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">ISO-Passungsrechner</h2>
                <p class="text-sm text-slate-400">Berechne, wie Bohrung und Welle zueinander passen (Spiel, Übergang, Presssitz).</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Calculator -->
                <div class="lg:col-span-7 bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                    
                    <!-- Presets -->
                    <div class="mb-6">
                        <label class="input-label text-orange-400">Schnellauswahl (Presets)</label>
                        <select id="iso-preset" class="input-field text-sm cursor-pointer" onchange="applyIsoPreset()">
                            <option value="">-- Individuell wählen --</option>
                            <option value="H7-h6">H7 / h6 - Spielpassung (leicht beweglich)</option>
                            <option value="H7-g6">H7 / g6 - Spielpassung (leichtes Spiel)</option>
                            <option value="H7-f7">H7 / f7 - Enge Spielpassung</option>
                            <option value="H7-k6">H7 / k6 - Übergangspassung</option>
                            <option value="H7-p6">H7 / p6 - Übermaßpassung (Presssitz)</option>
                        </select>
                    </div>

                    <div class="mb-6 border-t border-slate-700 pt-4">
                        <label class="input-label">Nennmaß (mm)</label>
                        <input type="number" id="iso-dim" class="input-field text-center text-xl font-bold" placeholder="20" oninput="calcIsoFit()">
                        <p class="text-[10px] text-slate-500 mt-1 text-center">Bereich: 1 - 500 mm</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6 relative">
                        <!-- Bohrung -->
                        <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                            <div class="flex items-center gap-2 mb-2 justify-center text-green-400 font-bold uppercase text-xs">
                                <i class="ph ph-circle-notch"></i> Bohrung
                            </div>
                            <div class="flex gap-1 justify-center">
                                <select id="iso-hole-char" class="input-field text-center w-16 px-1" onchange="calcIsoFit()">
                                    <option value="H">H</option><option value="G">G</option><option value="F">F</option><option value="P">P</option>
                                </select>
                                <select id="iso-hole-num" class="input-field text-center w-16 px-1" onchange="calcIsoFit()">
                                    <option value="6">6</option><option value="7" selected>7</option><option value="8">8</option><option value="9">9</option>
                                </select>
                            </div>
                            <div class="mt-3 text-center">
                                <div id="res-hole-dev" class="font-mono text-xs text-slate-400">--</div>
                                <div id="res-hole-range" class="font-mono font-bold text-sm text-white mt-1">--</div>
                            </div>
                        </div>

                        <!-- Welle -->
                        <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                            <div class="flex items-center gap-2 mb-2 justify-center text-blue-400 font-bold uppercase text-xs">
                                <i class="ph ph-circle"></i> Welle
                            </div>
                            <div class="flex gap-1 justify-center">
                                <select id="iso-shaft-char" class="input-field text-center w-16 px-1" onchange="calcIsoFit()">
                                    <option value="h" selected>h</option><option value="g">g</option><option value="f">f</option><option value="k">k</option><option value="m">m</option><option value="p">p</option>
                                </select>
                                <select id="iso-shaft-num" class="input-field text-center w-16 px-1" onchange="calcIsoFit()">
                                    <option value="5">5</option><option value="6" selected>6</option><option value="7">7</option><option value="9">9</option>
                                </select>
                            </div>
                            <div class="mt-3 text-center">
                                <div id="res-shaft-dev" class="font-mono text-xs text-slate-400">--</div>
                                <div id="res-shaft-range" class="font-mono font-bold text-sm text-white mt-1">--</div>
                            </div>
                        </div>
                    </div>

                    <!-- Fit Result -->
                    <div id="fit-result-box" class="bg-slate-900 p-4 rounded-lg border border-slate-600 text-center hidden animate-pulse-once">
                        <div class="text-xs text-slate-400 uppercase tracking-widest mb-1">Erwartete Passungsart</div>
                        <div id="fit-type" class="text-xl font-bold text-white mb-2">Spielpassung</div>
                        <div class="text-xs font-mono text-slate-300 bg-slate-800 inline-block px-2 py-1 rounded" id="fit-values">Min: 0.020 / Max: 0.054</div>
                    </div>
                    <div id="fit-error" class="text-center text-red-400 text-xs mt-4 hidden bg-red-900/20 p-2 rounded">
                        Diese Kombination ist im Tool noch nicht hinterlegt. Bitte wähle eine typische Passung.
                    </div>
                </div>

                <!-- Info Column (Lernkasten) -->
                <div class="lg:col-span-5 space-y-4">
                    <div class="bg-slate-800 p-5 rounded-xl border border-slate-700">
                        <h4 class="font-bold text-sm text-white mb-3 flex items-center gap-2"><i class="ph ph-graduation-cap text-orange-500 text-lg"></i> Passung lesen lernen</h4>
                        <div class="text-xs text-slate-300 space-y-3 leading-relaxed">
                            <p><strong>Beispiel: 20 H7/g6</strong></p>
                            <ul class="list-disc pl-4 space-y-1 text-slate-400">
                                <li><strong>20</strong> = Nennmaß in mm</li>
                                <li><strong>H7</strong> = Bohrung (Großbuchstabe)</li>
                                <li><strong>g6</strong> = Welle (Kleinbuchstabe)</li>
                                <li><strong>Zahl</strong> = Toleranzgrad (kleiner = genauer)</li>
                            </ul>
                            <div class="bg-slate-900 p-2 rounded border border-slate-700 mt-2">
                                <p class="text-slate-400 mb-1">Ergebnis im Beispiel:</p>
                                <p class="text-green-400">Bohrung: 20,000 – 20,021 mm</p>
                                <p class="text-blue-400">Welle: 19,979 – 19,994 mm</p>
                                <p class="text-white mt-1 border-t border-slate-700 pt-1">→ Immer Spiel (0,006 – 0,042 mm)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 text-xs text-slate-400">
                        <h5 class="font-bold text-slate-200 mb-2">Passungsarten</h5>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2"><span class="w-2 h-2 bg-green-500 rounded-full"></span> <span><strong>Spiel:</strong> Teile bewegen sich (z.B. Lager).</span></div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 bg-yellow-500 rounded-full"></span> <span><strong>Übergang:</strong> Klemmen oder Rutschen möglich.</span></div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 bg-red-500 rounded-full"></span> <span><strong>Übermaß:</strong> Feste Verbindung (Presssitz).</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: GEWINDE -->
        <div id="tab-gewinde" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Gewinde & Kernlöcher</h2>
                <p class="text-sm text-slate-400">Finde sofort den richtigen Bohrer für dein Gewinde. Metrisch & Zoll (UNC/UNF).</p>
            </div>

            <div class="max-w-xl mx-auto">
                <!-- Calculator Widget -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg mb-8">
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="input-group">
                            <label>Gewindeart</label>
                            <select id="th-type" class="input-field cursor-pointer" onchange="updateThreadList()">
                                <option value="M">Metrisch Regel (M)</option>
                                <option value="MF">Metrisch Fein (MF)</option>
                                <option value="UNC">Zoll Grob (UNC)</option>
                                <option value="UNF">Zoll Fein (UNF)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Größe</label>
                            <select id="th-size" class="input-field cursor-pointer font-bold" onchange="calcThread()">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center py-4 bg-slate-900 rounded-xl border border-slate-700 relative">
                        <div class="text-[10px] text-slate-400 uppercase tracking-widest mb-1">Kernlochdurchmesser (Bohrer)</div>
                        <div class="text-5xl font-mono font-bold text-indigo-400 mb-2"><span id="res-thread-drill">--</span> <span class="text-lg text-slate-500">mm</span></div>
                        <div class="text-xs text-slate-500" id="thread-hint">
                            Faustformel: Nennmaß – Steigung ≈ Kernloch
                        </div>
                    </div>
                </div>

                <!-- Table Preview -->
                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <div class="bg-slate-950 p-3 border-b border-slate-700 flex justify-between items-center">
                        <h4 class="text-sm font-bold text-white">Schnellübersicht (Gängige Größen)</h4>
                    </div>
                    <div class="p-4 grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm font-mono">
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>M6</span><span class="text-indigo-400 font-bold">5.0</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>M8</span><span class="text-indigo-400 font-bold">6.8</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>M10</span><span class="text-indigo-400 font-bold">8.5</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>1/4"-20</span><span class="text-orange-400 font-bold">5.1</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>5/16"-18</span><span class="text-orange-400 font-bold">6.6</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>3/8"-16</span><span class="text-orange-400 font-bold">8.0</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>1/2"-13</span><span class="text-orange-400 font-bold">10.8</span></div>
                        <div class="flex justify-between border-b border-slate-700 pb-1"><span>M16</span><span class="text-indigo-400 font-bold">14.0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: SCHRAUBEN & SENKUNGEN -->
        <div id="tab-schrauben" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Bohrungen & Senkungen</h2>
                <p class="text-sm text-slate-400">Maße für Durchgangslöcher und Senkungen (DIN 974 / 7991).</p>
            </div>

            <div class="max-w-2xl mx-auto">
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                    
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div class="input-group">
                            <label>Schraubenart</label>
                            <select id="scr-type" class="input-field text-sm cursor-pointer" onchange="calcScrew()">
                                <option value="912">Zylinderkopf (DIN 912)</option>
                                <option value="7991">Senkkopf (DIN 7991)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Größe</label>
                            <select id="scr-size" class="input-field text-sm cursor-pointer font-bold" onchange="calcScrew()">
                                <option value="M3">M3</option>
                                <option value="M4">M4</option>
                                <option value="M5">M5</option>
                                <option value="M6">M6</option>
                                <option value="M8">M8</option>
                                <option value="M10">M10</option>
                                <option value="M12">M12</option>
                                <option value="M16">M16</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>
                                Spielklasse
                                <span class="tooltip"><i class="ph ph-info text-slate-500 ml-1"></i>
                                    <span class="tooltiptext">Bestimmt den Zapfen-Ø! eng: f, mittel: m, groß: c.</span>
                                </span>
                            </label>
                            <select id="scr-fit" class="input-field text-sm cursor-pointer" onchange="calcScrew()">
                                <option value="f">eng (f)</option>
                                <option value="m" selected>mittel (m)</option>
                                <option value="c">groß (c)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Results Layout -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 items-start">
                        <!-- Through Hole -->
                        <div class="bg-slate-900 p-4 rounded-xl border border-slate-600 text-center h-full flex flex-col justify-center relative">
                            <div class="text-[10px] text-slate-400 uppercase font-bold mb-2">Bohrung / Zapfen-Ø</div>
                            <div class="text-4xl font-mono font-bold text-white mb-1"><span id="res-scr-hole">--</span> <span class="text-lg text-slate-500">mm</span></div>
                            <div class="text-[10px] text-orange-400 font-bold" id="res-scr-fit-text">Mittel (m)</div>
                            <div class="absolute top-2 right-2 text-slate-600 text-xs"><i class="ph ph-ruler"></i></div>
                        </div>

                        <!-- Counterbore Info -->
                        <div class="space-y-3">
                            <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700 flex justify-between items-center">
                                <span class="text-xs text-slate-400">Schraubenkopf-Ø (dk):</span>
                                <span class="font-mono font-bold text-white" id="res-scr-dk">-- mm</span>
                            </div>
                            
                            <!-- Zylinder Spec (DIN 974) -->
                            <div id="res-spec-912" class="hidden space-y-3">
                                <div class="bg-blue-900/20 p-3 rounded-lg border border-blue-800/30">
                                    <div class="text-xs font-bold text-blue-300 mb-2 flex items-center gap-2"><i class="ph ph-arrow-fat-down"></i> Zapfensenkung (DIN 974-1)</div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs text-slate-400">Senk-Ø (d2):</span>
                                        <span class="font-mono font-bold text-white" id="res-scr-cb-dia">-- mm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-slate-400">Senktiefe (t):</span>
                                        <span class="font-mono font-bold text-white" id="res-scr-cb-depth">-- mm</span>
                                    </div>
                                </div>
                                <div class="text-[9px] text-slate-500 leading-tight">
                                    Hinweis: Zapfensenker muss zur gewählten Bohrung (<span class="res-fit-ref font-bold">m</span>) passen. Tiefe t = Kopfhöhe k + 0.4mm.
                                </div>
                            </div>

                            <!-- Senk Spec (DIN 7991) -->
                            <div id="res-spec-7991" class="hidden space-y-3">
                                <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700 flex justify-between items-center">
                                    <span class="text-xs text-orange-400 font-bold">Senk-Ø (d_senk):</span>
                                    <span class="font-mono font-bold text-white" id="res-scr-cs-dia">-- mm</span>
                                </div>
                                <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700 flex justify-between items-center">
                                    <span class="text-xs text-orange-400 font-bold">Senktiefe (t):</span>
                                    <span class="font-mono font-bold text-white" id="res-scr-cs-depth">-- mm</span>
                                </div>
                                <div class="text-[10px] text-slate-500 text-center">90° Senkung für bündigen Sitz.</div>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-[10px] text-slate-500 mt-6 text-center border-t border-slate-700 pt-2">
                        Maße sind Richtwerte nach DIN 974-1 (Reihe 1) und DIN ISO 273.
                    </p>

                </div>
            </div>
        </div>

        <!-- TAB 6: EINHEITEN & UMRECHNER (NEU) -->
        <div id="tab-einheiten" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Einheiten & Umrechner</h2>
                <p class="text-sm text-slate-400">Hier wandelst du schnell typische Einheiten um oder rechnest Schnittdaten rückwärts.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- A) Einheiten-Rechner -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                    <h3 class="font-bold text-slate-200 mb-4 flex items-center gap-2"><i class="ph ph-arrows-left-right text-indigo-400"></i> Umrechnen</h3>
                    
                    <!-- Länge -->
                    <div class="mb-6 p-4 bg-slate-900/50 rounded-lg border border-slate-700/50">
                        <div class="text-xs text-slate-500 uppercase font-bold mb-2">Länge (mm ↔ Zoll)</div>
                        <div class="grid grid-cols-2 gap-2 items-center">
                            <div class="relative">
                                <input type="number" id="conv-mm" class="input-field pr-8" placeholder="mm" oninput="calcUnit('mm_inch')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">mm</span>
                            </div>
                            <div class="relative">
                                <input type="number" id="conv-inch" class="input-field pr-8" placeholder="inch" oninput="calcUnit('inch_mm')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">in</span>
                            </div>
                        </div>
                    </div>

                    <!-- Winkel -->
                    <div class="mb-6 p-4 bg-slate-900/50 rounded-lg border border-slate-700/50">
                        <div class="text-xs text-slate-500 uppercase font-bold mb-2">Winkel (Grad ↔ Radiant)</div>
                        <div class="grid grid-cols-2 gap-2 items-center">
                            <div class="relative">
                                <input type="number" id="conv-deg" class="input-field pr-8" placeholder="deg" oninput="calcUnit('deg_rad')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">°</span>
                            </div>
                            <div class="relative">
                                <input type="number" id="conv-rad" class="input-field pr-8" placeholder="rad" oninput="calcUnit('rad_deg')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">rad</span>
                            </div>
                        </div>
                    </div>

                    <!-- Geschwindigkeit -->
                    <div class="p-4 bg-slate-900/50 rounded-lg border border-slate-700/50">
                        <div class="text-xs text-slate-500 uppercase font-bold mb-2">Geschwindigkeit (m/min ↔ m/s)</div>
                        <div class="grid grid-cols-2 gap-2 items-center">
                            <div class="relative">
                                <input type="number" id="conv-mmin" class="input-field pr-12" placeholder="m/min" oninput="calcUnit('mmin_ms')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">m/min</span>
                            </div>
                            <div class="relative">
                                <input type="number" id="conv-ms" class="input-field pr-8" placeholder="m/s" oninput="calcUnit('ms_mmin')">
                                <span class="absolute right-2 top-3 text-xs text-slate-500">m/s</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- B) Schnittdaten Rückwärts & Lernbox -->
                <div class="space-y-6">
                    <!-- Rückwärts Rechner -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                        <h3 class="font-bold text-slate-200 mb-4 flex items-center gap-2"><i class="ph ph-arrow-u-up-left text-orange-400"></i> Schnittdaten-Rückwärts</h3>
                        <p class="text-xs text-slate-400 mb-4">Berechne vc oder n, wenn du den jeweils anderen Wert hast.</p>
                        
                        <div class="flex gap-2 mb-4 bg-slate-900 p-1 rounded-lg">
                            <button onclick="toggleReverseMode('n')" id="btn-rev-n" class="flex-1 py-1 text-xs rounded font-bold bg-slate-700 text-white transition">Ich habe: n (Drehzahl)</button>
                            <button onclick="toggleReverseMode('vc')" id="btn-rev-vc" class="flex-1 py-1 text-xs rounded font-bold text-slate-400 hover:text-white transition">Ich habe: vc (Schnitt)</button>
                        </div>

                        <div class="space-y-3">
                            <div class="input-group">
                                <label>Werkzeug-Ø d [mm]</label>
                                <input type="number" id="rev-d" class="input-field" value="10" oninput="calcReverseSchnitt()">
                            </div>
                            
                            <div id="input-rev-n" class="input-group">
                                <label>Gegebene Drehzahl n [U/min]</label>
                                <input type="number" id="rev-in-n" class="input-field" value="3000" oninput="calcReverseSchnitt()">
                            </div>
                            
                            <div id="input-rev-vc" class="input-group hidden">
                                <label>Gegebene Schnittgeschw. vc [m/min]</label>
                                <input type="number" id="rev-in-vc" class="input-field" value="100" oninput="calcReverseSchnitt()">
                            </div>

                            <div class="mt-4 pt-4 border-t border-slate-700 text-center">
                                <div class="text-xs text-slate-500 uppercase font-bold mb-1" id="res-rev-label">Ergebnis: Schnittgeschw. (vc)</div>
                                <div class="text-3xl font-mono font-bold text-white"><span id="res-rev-val">--</span> <span class="text-sm text-slate-400" id="res-rev-unit">m/min</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Lernkasten -->
                    <div class="bg-slate-800 p-5 rounded-xl border border-slate-700">
                        <h4 class="font-bold text-sm text-white mb-3 flex items-center gap-2"><i class="ph ph-lightbulb text-yellow-500 text-lg"></i> Beispiele aus der Praxis</h4>
                        <ul class="text-xs text-slate-300 space-y-2 list-disc pl-4">
                            <li><strong>10 mm Bohrer:</strong> Bei vc = 25 m/min brauchst du ca. 800 U/min.</li>
                            <li><strong>Zoll:</strong> 12,7 mm entsprechen genau 1/2" (Halbzeoll).</li>
                            <li><strong>Speed:</strong> 600 m/min sind umgerechnet 10 m/s.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 7: MATERIAL & GEWICHT (NEU) -->
        <div id="tab-gewicht" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-1">Material & Gewicht</h2>
                <p class="text-sm text-slate-400">Berechne das Gewicht von Rundmaterial, Vierkant, Flachstahl und Rohren.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Rechner -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="input-group">
                            <label>Material</label>
                            <select id="mat-type" class="input-field text-sm cursor-pointer" onchange="calcMaterialWeight()">
                                <option value="7.85">Stahl (7.85)</option>
                                <option value="7.9">Edelstahl (7.9)</option>
                                <option value="2.7">Aluminium (2.7)</option>
                                <option value="8.5">Messing (8.5)</option>
                                <option value="8.9">Kupfer (8.9)</option>
                                <option value="1.2">Kunststoff (ca. 1.2)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Profil</label>
                            <select id="mat-shape" class="input-field text-sm cursor-pointer" onchange="updateShapeInputs()">
                                <option value="round">Rund (voll)</option>
                                <option value="square">Vierkant</option>
                                <option value="flat">Flach</option>
                                <option value="tube">Rohr</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dynamic Inputs -->
                    <div class="space-y-3 mb-6 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50">
                        
                        <!-- Rund -->
                        <div id="shape-round" class="shape-group">
                            <div class="input-group">
                                <label>Durchmesser d [mm]</label>
                                <input type="number" id="dim-d" class="input-field" value="20" oninput="calcMaterialWeight()">
                            </div>
                        </div>

                        <!-- Square -->
                        <div id="shape-square" class="shape-group hidden">
                            <div class="input-group">
                                <label>Seitenlänge a [mm]</label>
                                <input type="number" id="dim-a" class="input-field" value="20" oninput="calcMaterialWeight()">
                            </div>
                        </div>

                        <!-- Flat -->
                        <div id="shape-flat" class="shape-group hidden">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>Breite b [mm]</label>
                                    <input type="number" id="dim-b" class="input-field" value="50" oninput="calcMaterialWeight()">
                                </div>
                                <div class="input-group">
                                    <label>Stärke h [mm]</label>
                                    <input type="number" id="dim-h" class="input-field" value="10" oninput="calcMaterialWeight()">
                                </div>
                            </div>
                        </div>

                        <!-- Tube -->
                        <div id="shape-tube" class="shape-group hidden">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>Außen-Ø D [mm]</label>
                                    <input type="number" id="dim-D_out" class="input-field" value="40" oninput="calcMaterialWeight()">
                                </div>
                                <div class="input-group">
                                    <label>Innen-Ø d [mm]</label>
                                    <input type="number" id="dim-d_in" class="input-field" value="30" oninput="calcMaterialWeight()">
                                </div>
                            </div>
                        </div>

                        <!-- Common -->
                        <div class="grid grid-cols-2 gap-4 mt-3 border-t border-slate-700 pt-3">
                            <div class="input-group">
                                <label>Länge L [mm]</label>
                                <input type="number" id="dim-L" class="input-field" value="1000" oninput="calcMaterialWeight()">
                            </div>
                            <div class="input-group">
                                <label>Stückzahl</label>
                                <input type="number" id="dim-n" class="input-field" value="1" oninput="calcMaterialWeight()">
                            </div>
                        </div>
                    </div>

                    <!-- Result -->
                    <div class="bg-slate-900 p-4 rounded-lg border border-slate-600">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-slate-400 uppercase">Gewicht pro Stück</span>
                            <span class="font-mono font-bold text-white"><span id="res-weight-single">0.00</span> kg</span>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t border-slate-700">
                            <span class="text-xs text-orange-400 font-bold uppercase">Gesamtgewicht</span>
                            <span class="text-2xl font-mono font-bold text-orange-500"><span id="res-weight-total">0.00</span> kg</span>
                        </div>
                    </div>

                </div>

                <!-- Info Box -->
                <div class="space-y-6">
                    <div class="bg-slate-800 p-5 rounded-xl border border-slate-700">
                        <h4 class="font-bold text-sm text-white mb-3 flex items-center gap-2"><i class="ph ph-question text-blue-400 text-lg"></i> Wofür brauche ich das?</h4>
                        <ul class="text-xs text-slate-300 space-y-2 list-disc pl-4 leading-relaxed">
                            <li><strong>Heben:</strong> Schnell checken, ob du das Rohteil alleine auf die Maschine wuchten kannst (ab 25 kg besser Kran!).</li>
                            <li><strong>Kalkulation:</strong> Wenn du Materialpreis pro kg kennst, hast du sofort den Preis.</li>
                            <li><strong>Sägen:</strong> Prüfen, ob der Restbestand im Lager für den Auftrag reicht (Länge abschätzen).</li>
                        </ul>
                    </div>

                    <div class="bg-slate-800 p-5 rounded-xl border border-slate-700">
                        <h4 class="font-bold text-sm text-white mb-2">Rechenbeispiel</h4>
                        <div class="bg-slate-900 p-3 rounded text-xs font-mono text-slate-400 border border-slate-700">
                            1 m Rundstahl Ø 30 mm (Stahl)<br>
                            Fläche A ≈ 706,9 mm²<br>
                            Volumen V ≈ 706,9 cm³<br>
                            Gewicht ≈ 706,9 * 7,85 / 1000<br>
                            = <span class="text-white font-bold">5,55 kg</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script>
        // --- Navigation Logic ---
        function switchTab(id) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            // Reset nav buttons
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('active', 'text-orange-500', 'border-orange-500');
                el.classList.add('text-slate-400', 'border-transparent');
            });
            
            // Show target
            document.getElementById('tab-' + id).classList.add('active');
            
            // Highlight button
            const ids = ['schnitt', 'toleranzen', 'iso', 'gewinde', 'schrauben', 'einheiten', 'gewicht'];
            const idx = ids.indexOf(id);
            if(idx > -1) {
                const btns = document.querySelectorAll('.nav-btn');
                btns[idx].classList.remove('text-slate-400', 'border-transparent');
                btns[idx].classList.add('active', 'text-orange-500', 'border-orange-500');
            }
        }

        /* =========================================
           1. SCHNITTDATEN RECHNER
           ========================================= */
        function loadCuttingPresets() {
            const mat = document.getElementById('cut-mat').value;
            const op = document.getElementById('cut-op').value;
            
            // Richtwerte [vc, fz]
            const presets = {
                steel: { drill: [25, 0.1], mill_rough: [120, 0.05], mill_finish: [180, 0.03] },
                inox:  { drill: [15, 0.08], mill_rough: [80, 0.04], mill_finish: [120, 0.03] },
                alu:   { drill: [80, 0.2],  mill_rough: [400, 0.1], mill_finish: [600, 0.08] },
                plastic: { drill: [60, 0.2], mill_rough: [300, 0.15], mill_finish: [400, 0.1] }
            };

            if (presets[mat] && presets[mat][op]) {
                const [vc, fz] = presets[mat][op];
                document.getElementById('inp-vc').value = vc;
                document.getElementById('inp-fz').value = fz;
                
                if (op === 'drill') document.getElementById('inp-z').value = 2;
                else if (document.getElementById('inp-z').value == 2) document.getElementById('inp-z').value = 4;

                calcSchnitt();
            }
        }

        function calcSchnitt() {
            const d = parseFloat(document.getElementById('inp-d').value) || 0;
            const vc = parseFloat(document.getElementById('inp-vc').value) || 0;
            const z = parseFloat(document.getElementById('inp-z').value) || 0;
            const fz = parseFloat(document.getElementById('inp-fz').value) || 0;
            const ap = parseFloat(document.getElementById('inp-ap').value) || 0;
            const ae = parseFloat(document.getElementById('inp-ae').value) || 0;

            if (d <= 0 || vc <= 0) {
                document.getElementById('res-n').innerText = "0";
                document.getElementById('res-vf').innerText = "0";
                return;
            }

            const n = (vc * 1000) / (Math.PI * d);
            const vf = n * z * fz;
            let q = 0;
            if (ap > 0 && ae > 0) {
                q = (ap * ae * vf) / 1000;
            }

            document.getElementById('res-n').innerText = n.toFixed(0);
            document.getElementById('res-vf').innerText = vf.toFixed(0);
            document.getElementById('res-q').innerText = q > 0 ? q.toFixed(1) : "--";

            const warn = document.getElementById('rpm-warning');
            if (n > 20000) warn.classList.remove('hidden');
            else warn.classList.add('hidden');
        }

        /* =========================================
           2. TOLERANZEN ISO 2768
           ========================================= */
        const tol2768Table = [
            { max: 3, vals: [0.05, 0.1, 0.2] },
            { max: 6, vals: [0.05, 0.1, 0.3] },
            { max: 30, vals: [0.1, 0.2, 0.5] },
            { max: 120, vals: [0.15, 0.3, 0.8] },
            { max: 400, vals: [0.2, 0.5, 1.2] },
            { max: 1000, vals: [0.3, 0.8, 2.0] },
            { max: 2000, vals: [0.5, 1.2, 3.0] }
        ];

        function calcToleranz2768() {
            const dim = parseFloat(document.getElementById('tol2768-dim').value);
            const cls = document.getElementById('tol2768-class').value;
            const resBox = document.getElementById('tol2768-res');
            const errBox = document.getElementById('tol2768-error');

            if (!dim || dim < 0.5 || dim > 2000) {
                resBox.classList.add('hidden');
                if(dim) errBox.classList.remove('hidden');
                return;
            }
            errBox.classList.add('hidden');

            const entry = tol2768Table.find(e => dim <= e.max);
            
            let idx = 0; // f
            if (cls === 'm') idx = 1;
            if (cls === 'c') idx = 2;

            const tol = entry.vals[idx];
            
            document.getElementById('tol2768-val').innerText = tol.toFixed(2);
            document.getElementById('tol2768-range').innerText = (dim - tol).toFixed(2) + " - " + (dim + tol).toFixed(2);
            resBox.classList.remove('hidden');
        }

        /* =========================================
           3. ISO PASSUNGEN
           ========================================= */
        const isoData = [
            { max: 3,   H7:[10,0], H8:[14,0], h6:[0,-6], g6:[-2,-8], f7:[-6,-16], k6:[6,0], p6:[12,6] },
            { max: 6,   H7:[12,0], H8:[18,0], h6:[0,-8], g6:[-4,-12], f7:[-10,-22], k6:[9,1], p6:[20,12] },
            { max: 10,  H7:[15,0], H8:[22,0], h6:[0,-9], g6:[-5,-14], f7:[-13,-28], k6:[10,1], p6:[24,15] },
            { max: 18,  H7:[18,0], H8:[27,0], h6:[0,-11], g6:[-6,-17], f7:[-16,-34], k6:[12,1], p6:[29,18] },
            { max: 30,  H7:[21,0], H8:[33,0], h6:[0,-13], g6:[-7,-20], f7:[-20,-41], k6:[15,2], p6:[35,22] },
            { max: 50,  H7:[25,0], H8:[39,0], h6:[0,-16], g6:[-9,-25], f7:[-25,-50], k6:[18,2], p6:[42,26] },
            { max: 80,  H7:[30,0], H8:[46,0], h6:[0,-19], g6:[-10,-29], f7:[-30,-60], k6:[21,2], p6:[51,32] },
            { max: 120, H7:[35,0], H8:[54,0], h6:[0,-22], g6:[-12,-34], f7:[-36,-71], k6:[25,3], p6:[59,37] },
            { max: 500, H7:[63,0], H8:[97,0], h6:[0,-40], g6:[-20,-60], f7:[-68,-131], k6:[45,5], p6:[108,68] } 
        ];

        function applyIsoPreset() {
            const val = document.getElementById('iso-preset').value;
            if(!val) return;
            
            const [hole, shaft] = val.split('-');
            document.getElementById('iso-hole-char').value = hole.charAt(0);
            document.getElementById('iso-hole-num').value = hole.charAt(1);
            document.getElementById('iso-shaft-char').value = shaft.charAt(0);
            document.getElementById('iso-shaft-num').value = shaft.charAt(1);
            
            calcIsoFit();
        }

        function getIsoValues(dim, code) {
            const entry = isoData.find(e => dim <= e.max);
            if (!entry) return null;
            if (entry[code]) return entry[code];
            return null;
        }

        function calcIsoFit() {
            const dim = parseFloat(document.getElementById('iso-dim').value);
            const holeCode = document.getElementById('iso-hole-char').value + document.getElementById('iso-hole-num').value;
            const shaftCode = document.getElementById('iso-shaft-char').value + document.getElementById('iso-shaft-num').value;

            const resBox = document.getElementById('fit-result-box');
            const errBox = document.getElementById('fit-error');

            if (!dim || dim < 1 || dim > 500) {
                resBox.classList.add('hidden');
                errBox.classList.add('hidden');
                return;
            }

            const hVals = getIsoValues(dim, holeCode);
            const sVals = getIsoValues(dim, shaftCode);

            if (hVals && sVals) {
                errBox.classList.add('hidden');
                resBox.classList.remove('hidden');

                const hUp = hVals[0] / 1000;
                const hLo = hVals[1] / 1000;
                const sUp = sVals[0] / 1000;
                const sLo = sVals[1] / 1000;

                document.getElementById('res-hole-dev').innerText = `${fmt(hUp)} / ${fmt(hLo)}`;
                document.getElementById('res-shaft-dev').innerText = `${fmt(sUp)} / ${fmt(sLo)}`;

                const hMax = dim + hUp;
                const hMin = dim + hLo;
                const sMax = dim + sUp;
                const sMin = dim + sLo;

                document.getElementById('res-hole-range').innerText = `${hMin.toFixed(3)} - ${hMax.toFixed(3)}`;
                document.getElementById('res-shaft-range').innerText = `${sMin.toFixed(3)} - ${sMax.toFixed(3)}`;

                const maxClearance = hMax - sMin; 
                const minClearance = hMin - sMax; 

                const typeEl = document.getElementById('fit-type');
                const valEl = document.getElementById('fit-values');

                if (minClearance >= 0) {
                    typeEl.innerText = "Spielpassung";
                    typeEl.className = "text-xl font-bold text-green-400 mb-2";
                    valEl.innerText = `Spiel: ${(minClearance * 1000).toFixed(0)} bis ${(maxClearance * 1000).toFixed(0)} µm`;
                } else if (maxClearance <= 0) {
                    typeEl.innerText = "Übermaßpassung (Presssitz)";
                    typeEl.className = "text-xl font-bold text-red-400 mb-2";
                    valEl.innerText = `Übermaß: ${(Math.abs(maxClearance) * 1000).toFixed(0)} bis ${(Math.abs(minClearance) * 1000).toFixed(0)} µm`;
                } else {
                    typeEl.innerText = "Übergangspassung";
                    typeEl.className = "text-xl font-bold text-yellow-400 mb-2";
                    valEl.innerText = `Übergang: ${(Math.abs(minClearance)*1000).toFixed(0)} µm Übermaß bis ${(maxClearance*1000).toFixed(0)} µm Spiel`;
                }

            } else {
                resBox.classList.add('hidden');
                errBox.classList.remove('hidden');
            }
        }
        
        function fmt(num) { return (num >= 0 ? '+' : '') + num.toFixed(3); }

        /* =========================================
           4. GEWINDE & KERNLÖCHER
           ========================================= */
        const threads = {
            'M': {
                'M1': 0.75, 'M1.2': 0.95, 'M1.6': 1.25, 'M2': 1.6, 'M2.5': 2.05,
                'M3': 2.5, 'M4': 3.3, 'M5': 4.2, 'M6': 5.0, 'M8': 6.8, 
                'M10': 8.5, 'M12': 10.2, 'M14': 12.0, 'M16': 14.0, 'M18': 15.5, 
                'M20': 17.5, 'M22': 19.5, 'M24': 21.0, 'M27': 24.0, 'M30': 26.5, 
                'M33': 29.5, 'M36': 32.0
            },
            'MF': {
                'M3 x 0.35': 2.65, 'M4 x 0.5': 3.5, 'M5 x 0.5': 4.5, 'M6 x 0.75': 5.25,
                'M8 x 1.0': 7.0, 'M10 x 1.0': 9.0, 'M10 x 1.25': 8.8, 
                'M12 x 1.25': 10.8, 'M12 x 1.5': 10.5, 'M14 x 1.5': 12.5, 
                'M16 x 1.5': 14.5, 'M18 x 1.5': 16.5, 'M20 x 1.5': 18.5,
                'M22 x 1.5': 20.5, 'M24 x 1.5': 22.5, 'M24 x 2.0': 22.0,
                'M27 x 2.0': 25.0, 'M30 x 2.0': 28.0, 'M32 x 1.5': 30.5
            },
            'UNC': {
                'No. 1 - 64': 1.5, 'No. 2 - 56': 1.85, 'No. 3 - 48': 2.1, 'No. 4 - 40': 2.35,
                'No. 5 - 40': 2.65, 'No. 6 - 32': 2.85, 'No. 8 - 32': 3.5, 'No. 10 - 24': 3.9,
                'No. 12 - 24': 4.5, '1/4" - 20': 5.1, '5/16" - 18': 6.6, '3/8" - 16': 8.0, 
                '7/16" - 14': 9.4, '1/2" - 13': 10.8, '9/16" - 12': 12.2, '5/8" - 11': 13.5, 
                '3/4" - 10': 16.5, '7/8" - 9': 19.5, '1" - 8': 22.25, '1 1/8" - 7': 25.0, 
                '1 1/4" - 7': 28.25, '1 1/2" - 6': 34.0
            },
            'UNF': {
                'No. 0 - 80': 1.25, 'No. 1 - 72': 1.55, 'No. 2 - 64': 1.9, 'No. 3 - 56': 2.15,
                'No. 4 - 48': 2.4, 'No. 5 - 44': 2.7, 'No. 6 - 40': 2.95, 'No. 8 - 36': 3.5,
                'No. 10 - 32': 4.1, 'No. 12 - 28': 4.7, '1/4" - 28': 5.5, '5/16" - 24': 6.9, 
                '3/8" - 24': 8.5, '7/16" - 20': 9.9, '1/2" - 20': 11.5, '9/16" - 18': 12.9, 
                '5/8" - 18': 14.5, '3/4" - 16': 17.5, '7/8" - 14': 20.4, '1" - 12': 23.25, 
                '1" - 14': 23.5, '1 1/8" - 12': 26.5, '1 1/4" - 12': 29.5, '1 1/2" - 12': 36.0
            }
        };

        function updateThreadList() {
            const type = document.getElementById('th-type').value;
            const sizeSelect = document.getElementById('th-size');
            const hint = document.getElementById('thread-hint');
            sizeSelect.innerHTML = '';
            
            if (type.startsWith('UN')) {
                hint.innerText = "Kernloch für metrische Bohrer (mm) angenähert.";
            } else {
                hint.innerText = "Faustformel: Nennmaß – Steigung ≈ Kernloch";
            }
            
            for (const key in threads[type]) {
                const opt = document.createElement('option');
                opt.value = threads[type][key];
                opt.innerText = key;
                sizeSelect.appendChild(opt);
            }
            calcThread();
        }

        function calcThread() {
            const val = document.getElementById('th-size').value;
            document.getElementById('res-thread-drill').innerText = val;
        }

        /* =========================================
           5. SCHRAUBEN & SENKUNGEN
           ========================================= */
        const screwData = {
            'M3': { hole_f: 3.2, hole_m: 3.4, hole_c: 3.6, dk_912: 5.5, k_912: 3.0, d2_974: 6.0, dk_7991: 6.0, k_7991: 1.7 },
            'M4': { hole_f: 4.3, hole_m: 4.5, hole_c: 4.8, dk_912: 7.0, k_912: 4.0, d2_974: 8.0, dk_7991: 8.0, k_7991: 2.3 },
            'M5': { hole_f: 5.3, hole_m: 5.5, hole_c: 5.8, dk_912: 8.5, k_912: 5.0, d2_974: 10.0, dk_7991: 10.0, k_7991: 2.8 },
            'M6': { hole_f: 6.4, hole_m: 6.6, hole_c: 7.0, dk_912: 10.0, k_912: 6.0, d2_974: 11.0, dk_7991: 12.0, k_7991: 3.3 },
            'M8': { hole_f: 8.4, hole_m: 9.0, hole_c: 10.0, dk_912: 13.0, k_912: 8.0, d2_974: 15.0, dk_7991: 16.0, k_7991: 4.4 },
            'M10': { hole_f: 10.5, hole_m: 11.0, hole_c: 12.0, dk_912: 16.0, k_912: 10.0, d2_974: 18.0, dk_7991: 20.0, k_7991: 5.5 },
            'M12': { hole_f: 13.0, hole_m: 13.5, hole_c: 14.5, dk_912: 18.0, k_912: 12.0, d2_974: 20.0, dk_7991: 24.0, k_7991: 6.5 },
            'M16': { hole_f: 17.0, hole_m: 17.5, hole_c: 18.5, dk_912: 24.0, k_912: 16.0, d2_974: 26.0, dk_7991: 30.0, k_7991: 7.5 }
        };

        function calcScrew() {
            const type = document.getElementById('scr-type').value;
            const size = document.getElementById('scr-size').value;
            const fit = document.getElementById('scr-fit').value;
            
            const data = screwData[size];
            
            // Durchgangsbohrung
            let hole = data['hole_' + fit];
            document.getElementById('res-scr-hole').innerText = hole.toFixed(1);
            
            const fitMap = { 'f': 'Eng (fein)', 'm': 'Standard (mittel)', 'c': 'Groß (grob)' };
            document.getElementById('res-scr-fit-text').innerText = fitMap[fit];
            
            const refEls = document.querySelectorAll('.res-fit-ref');
            refEls.forEach(el => el.innerText = fit);

            // Kopfdaten
            if (type === '912') {
                document.getElementById('res-scr-dk').innerText = data.dk_912.toFixed(1) + " mm";
                
                // Zapfensenkung DIN 974-1 (Reihe 1)
                document.getElementById('res-scr-cb-dia').innerText = data.d2_974.toFixed(1) + " mm";
                // Tiefe = k + 0.4mm
                const depth = data.k_912 + 0.4;
                document.getElementById('res-scr-cb-depth').innerText = depth.toFixed(1) + " mm";

                document.getElementById('res-spec-912').classList.remove('hidden');
                document.getElementById('res-spec-7991').classList.add('hidden');
            } else {
                document.getElementById('res-scr-dk').innerText = data.dk_7991.toFixed(1) + " mm";
                
                // Senkung für Senkkopf: Ø = dk, Tiefe ≈ k
                document.getElementById('res-scr-cs-dia').innerText = data.dk_7991.toFixed(1) + " mm";
                document.getElementById('res-scr-cs-depth').innerText = data.k_7991.toFixed(1) + " mm";
                
                document.getElementById('res-spec-912').classList.add('hidden');
                document.getElementById('res-spec-7991').classList.remove('hidden');
            }
        }

        /* =========================================
           6. EINHEITEN & UMRECHNER
           ========================================= */
        function calcUnit(convType) {
            // convType = 'mm_inch', 'inch_mm', 'deg_rad', etc.
            
            if(convType === 'mm_inch') {
                const mm = parseFloat(document.getElementById('conv-mm').value);
                if(!isNaN(mm)) document.getElementById('conv-inch').value = (mm / 25.4).toFixed(4);
            } else if(convType === 'inch_mm') {
                const inch = parseFloat(document.getElementById('conv-inch').value);
                if(!isNaN(inch)) document.getElementById('conv-mm').value = (inch * 25.4).toFixed(2);
            }
            
            else if(convType === 'deg_rad') {
                const deg = parseFloat(document.getElementById('conv-deg').value);
                if(!isNaN(deg)) document.getElementById('conv-rad').value = (deg * (Math.PI / 180)).toFixed(4);
            } else if(convType === 'rad_deg') {
                const rad = parseFloat(document.getElementById('conv-rad').value);
                if(!isNaN(rad)) document.getElementById('conv-deg').value = (rad * (180 / Math.PI)).toFixed(2);
            }
            
            else if(convType === 'mmin_ms') {
                const mmin = parseFloat(document.getElementById('conv-mmin').value);
                if(!isNaN(mmin)) document.getElementById('conv-ms').value = (mmin / 60).toFixed(2);
            } else if(convType === 'ms_mmin') {
                const ms = parseFloat(document.getElementById('conv-ms').value);
                if(!isNaN(ms)) document.getElementById('conv-mmin').value = (ms * 60).toFixed(0);
            }
        }

        // --- Schnittdaten Rückwärts ---
        let revMode = 'n'; // We have N, want VC

        function toggleReverseMode(mode) {
            revMode = mode;
            // UI Switch
            if(mode === 'n') {
                document.getElementById('btn-rev-n').classList.remove('text-slate-400', 'hover:text-white');
                document.getElementById('btn-rev-n').classList.add('bg-slate-700', 'text-white');
                
                document.getElementById('btn-rev-vc').classList.add('text-slate-400', 'hover:text-white');
                document.getElementById('btn-rev-vc').classList.remove('bg-slate-700', 'text-white');
                
                document.getElementById('input-rev-n').classList.remove('hidden');
                document.getElementById('input-rev-vc').classList.add('hidden');
                
                document.getElementById('res-rev-label').innerText = "Ergebnis: Schnittgeschw. (vc)";
                document.getElementById('res-rev-unit').innerText = "m/min";
            } else {
                document.getElementById('btn-rev-vc').classList.remove('text-slate-400', 'hover:text-white');
                document.getElementById('btn-rev-vc').classList.add('bg-slate-700', 'text-white');
                
                document.getElementById('btn-rev-n').classList.add('text-slate-400', 'hover:text-white');
                document.getElementById('btn-rev-n').classList.remove('bg-slate-700', 'text-white');
                
                document.getElementById('input-rev-vc').classList.remove('hidden');
                document.getElementById('input-rev-n').classList.add('hidden');
                
                document.getElementById('res-rev-label').innerText = "Ergebnis: Drehzahl (n)";
                document.getElementById('res-rev-unit').innerText = "U/min";
            }
            calcReverseSchnitt();
        }

        function calcReverseSchnitt() {
            const d = parseFloat(document.getElementById('rev-d').value);
            const resVal = document.getElementById('res-rev-val');
            
            if(!d || d <= 0) { resVal.innerText = "--"; return; }

            if(revMode === 'n') {
                // Have n, want vc = (d * PI * n) / 1000
                const n = parseFloat(document.getElementById('rev-in-n').value);
                if(!n || n < 0) { resVal.innerText = "--"; return; }
                const vc = (d * Math.PI * n) / 1000;
                resVal.innerText = vc.toFixed(1);
            } else {
                // Have vc, want n = (vc * 1000) / (d * PI)
                const vc = parseFloat(document.getElementById('rev-in-vc').value);
                if(!vc || vc < 0) { resVal.innerText = "--"; return; }
                const n = (vc * 1000) / (d * Math.PI);
                resVal.innerText = n.toFixed(0);
            }
        }

        /* =========================================
           7. MATERIAL & GEWICHT
           ========================================= */
        function updateShapeInputs() {
            const shape = document.getElementById('mat-shape').value;
            // Hide all
            document.querySelectorAll('.shape-group').forEach(el => el.classList.add('hidden'));
            // Show active
            document.getElementById('shape-' + shape).classList.remove('hidden');
            calcMaterialWeight();
        }

        function calcMaterialWeight() {
            const rho = parseFloat(document.getElementById('mat-type').value); // g/cm3
            const shape = document.getElementById('mat-shape').value;
            const L = parseFloat(document.getElementById('dim-L').value); // mm
            const n = parseFloat(document.getElementById('dim-n').value);
            
            if(!L || L <= 0 || !n || n <= 0) {
                document.getElementById('res-weight-single').innerText = "0.00";
                document.getElementById('res-weight-total').innerText = "0.00";
                return;
            }

            let A = 0; // mm2

            if(shape === 'round') {
                const d = parseFloat(document.getElementById('dim-d').value);
                if(d > 0) A = Math.PI * Math.pow(d/2, 2);
            } else if(shape === 'square') {
                const a = parseFloat(document.getElementById('dim-a').value);
                if(a > 0) A = a * a;
            } else if(shape === 'flat') {
                const b = parseFloat(document.getElementById('dim-b').value);
                const h = parseFloat(document.getElementById('dim-h').value);
                if(b > 0 && h > 0) A = b * h;
            } else if(shape === 'tube') {
                const D = parseFloat(document.getElementById('dim-D_out').value);
                const d = parseFloat(document.getElementById('dim-d_in').value);
                if(D > 0 && D > d) A = Math.PI * (Math.pow(D/2, 2) - Math.pow(d/2, 2));
            }

            // Calc Volume in cm3 (A is mm2, L is mm -> V = mm3 / 1000)
            const V_cm3 = (A * L) / 1000;
            
            // Weight = Vol * Density (g) / 1000 -> kg
            const weightOne = (V_cm3 * rho) / 1000;
            const weightTotal = weightOne * n;

            document.getElementById('res-weight-single').innerText = weightOne.toFixed(2);
            document.getElementById('res-weight-total').innerText = weightTotal.toFixed(2);
        }

        // Init Calls
        updateThreadList();
        loadCuttingPresets();
        calcScrew();
    </script>
</body>
</html>