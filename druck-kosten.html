<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>3D-Druck-Kosten berechnen ‚Äì Schnellrechner</title>
  <meta name="description" content="3D-Druck Kosten berechnen: Material, Energie und Nacharbeit im Schnellrechner kalkulieren ‚Äì inklusive Tipps zur Preisfindung.">
  <meta name="keywords" content="3D Druck Kostenrechner, 3D Druck Kosten, Filament kalkulieren, Energieverbrauch 3D Druck, Nachbearbeitung Kosten, Preisfindung 3D Druck">
  <meta name="geo.region" content="DE-BW">
  <meta name="geo.placename" content="Donaueschingen">
  <meta name="geo.position" content="47.953;8.499">
  <meta name="ICBM" content="47.953,8.499">
  <link rel="icon" href="assets/logo.svg" type="image/svg+xml">
  <link rel="preload" as="image" href="assets/logo.svg">
  <script>
    (function () {
      var storageKey = 'theme-preference';
      var preference = 'system';
      try {
        var stored = localStorage.getItem(storageKey);
        if (stored === 'light' || stored === 'dark' || stored === 'system') {
          preference = stored;
        }
      } catch (error) {}
      var mediaQuery = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;
      var resolved = preference === 'dark'
        ? 'dark'
        : preference === 'light'
          ? 'light'
          : (mediaQuery && mediaQuery.matches ? 'dark' : 'light');
      var root = document.documentElement;
      root.dataset.theme = resolved;
      root.dataset.themePreference = preference;
    })();
  </script>
  <link rel="stylesheet" href="styles.css">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0d1117">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f8fafc">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0d1117">
  <meta name="color-scheme" content="light dark">
  <link rel="canonical" href="https://www.warenschmiede.com/druck-kosten.html">
  <meta property="og:title" content="3D-Druck-Kosten berechnen ‚Äì Schnellrechner">
  <meta property="og:description" content="3D-Druck Kosten berechnen: Material, Energie und Nacharbeit im Schnellrechner kalkulieren ‚Äì inklusive Tipps zur Preisfindung.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.warenschmiede.com/druck-kosten.html">
  <meta property="og:image" content="/assets/og/og-default.jpg">
  <meta property="og:site_name" content="Warenschmiede">
  <meta property="og:locale" content="de_DE">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body>
  <header class="site-header no-print" data-header>
    <div class="container header-grid">
      <div class="brand">
        <a class="brand-link" href="/index.html#start">
          <img src="assets/images/warenschmiede_logo.png" alt="Warenschmiede Logo" class="brand-logo" width="453" height="276" fetchpriority="high">
          <div class="brand-text">
            <span class="brand-name">Warenschmiede</span>
            <span class="brand-tagline">3D-Druck ¬∑ Made in Germany</span>
          </div>
        </a>
      </div>

      <nav class="main-nav" aria-label="Hauptnavigation">
        <div class="nav-menu" id="primary-navigation" data-nav-menu>
          <ul class="nav-list" id="navList">
            <li class="nav-item nav-fixed">
              <a class="nav-link" href="/index.html#start" data-nav-link data-section="start" data-path="/ , /index.html , /warenschmiede/ , /warenschmiede/index.html"><span class="nav-ico" aria-hidden="true">üè†</span>Start</a>
            </li>
            <li class="nav-item nav-fixed nav-more nav-dropdown nav-services" data-nav-dropdown>
              <button class="nav-more-btn" type="button" aria-haspopup="true" aria-expanded="false"><span class="nav-ico" aria-hidden="true">üß∞</span>Leistungen ‚ñæ</button>
              <ul class="nav-more-menu" hidden>
                <li>
                  <a class="nav-link" href="/leistungen/3d-druck.html" data-nav-link data-path="/leistungen/3d-druck , /leistungen/3d-druck.html"><span class="nav-ico" aria-hidden="true">üì¶</span>3D-Druckauftrag</a>
                </li>
                <li>
                  <a class="nav-link" href="/leistungen/cad-prototyping.html" data-nav-link data-path="/leistungen/cad-prototyping , /leistungen/cad-prototyping.html"><span class="nav-ico" aria-hidden="true">üìê</span>CAD &amp; Prototyping</a>
                </li>
                <li>
                  <a class="nav-link" href="/leistungen/pc-hilfe.html" data-nav-link data-path="/leistungen/pc-hilfe , /leistungen/pc-hilfe.html"><span class="nav-ico" aria-hidden="true">üíª</span>PC-Hilfe</a>
                </li>
              </ul>
            </li>
            <li class="nav-item nav-fixed nav-more nav-dropdown" data-nav-dropdown>
              <button class="nav-more-btn" type="button" aria-haspopup="true" aria-expanded="false"><span class="nav-ico" aria-hidden="true">ü§ñ</span>√úber KI ‚ñæ</button>
              <ul class="nav-more-menu" hidden>
                <li>
                  <a class="nav-link" href="/ki/index.html" data-nav-link data-path="/ki , /ki/ , /ki/index.html"><span class="nav-ico" aria-hidden="true">üìñ</span>Einf√ºhrung &amp; Grundlagen</a>
                </li>
                <li>
                  <a class="nav-link" href="/ki/prompts.html" data-nav-link data-path="/ki/prompts , /ki/prompts.html"><span class="nav-ico" aria-hidden="true">‚úçÔ∏è</span>Prompts f√ºr den Alltag</a>
                </li>
                <li>
                  <a class="nav-link" href="/ki/tools.html" data-nav-link data-path="/ki/tools , /ki/tools.html"><span class="nav-ico" aria-hidden="true">üõ†Ô∏è</span>KI-Werkzeuge</a>
                </li>
                <li>
                  <a class="nav-link" href="/ki/faq.html" data-nav-link data-path="/ki/faq , /ki/faq.html"><span class="nav-ico" aria-hidden="true">üîí</span>KI-FAQ &amp; Sicherheit</a>
                </li>
                <li>
                  <a class="nav-link" href="/ki/lexikon.html" data-nav-link data-path="/ki/lexikon , /ki/lexikon.html"><span class="nav-ico" aria-hidden="true">üî§</span>KI-Lexikon</a>
                </li>
              </ul>
            </li>
            <li class="nav-item nav-fixed nav-more nav-dropdown nav-contact" data-nav-dropdown>
              <button class="nav-more-btn" type="button" aria-haspopup="true" aria-expanded="false"><span class="nav-ico" aria-hidden="true">‚úâÔ∏è</span>Kontakt ‚ñæ</button>
              <ul class="nav-more-menu" hidden>
                <li>
                  <a class="nav-link" href="/kontakt.html" data-nav-link data-path="/kontakt , /kontakt.html , /warenschmiede/kontakt , /warenschmiede/kontakt.html"><span class="nav-ico" aria-hidden="true">üìß</span>Kontakt aufnehmen</a>
                </li>
                <li>
                  <a class="nav-link" href="/ueber-mich.html" data-nav-link data-path="/ueber-mich , /ueber-mich.html , /warenschmiede/ueber-mich.html , /about , /about.html , /warenschmiede/about.html"><span class="nav-ico" aria-hidden="true">üë§</span>√úber mich</a>
                </li>
              </ul>
            </li>
            <li class="nav-item nav-fixed nav-more nav-dropdown nav-3d" data-nav-dropdown>
              <button class="nav-more-btn" type="button" aria-haspopup="true" aria-expanded="false"><span class="nav-ico" aria-hidden="true">üì¶</span>3D-Druck ‚ñæ</button>
              <ul class="nav-more-menu" hidden>
                <li>
                  <a class="nav-link" href="/ideenquellen.html" data-nav-link data-path="/ideenquellen , /ideenquellen.html , /ideen , /ideen/ , /ideen/index.html"><span class="nav-ico" aria-hidden="true">üí°</span>Ideenquellen &amp; Portale</a>
                </li>
                <li>
                  <a class="nav-link" href="/material.html" data-nav-link data-path="/material.html , /material , /material/ , /material/index.html , /materials , /materials/ , /materials/index.html"><span class="nav-ico" aria-hidden="true">üìö</span>Materialwissen &amp; Vergleiche</a>
                </li>
                <li>
                  <a class="nav-link" href="/druck-tipps.html" data-nav-link data-path="/druck-tipps , /druck-tipps.html"><span class="nav-ico" aria-hidden="true">üß≠</span>Tipps &amp; Abl√§ufe / Kosten</a>
                </li>
                <li>
                  <a class="nav-link" href="/druck-kosten.html" data-nav-link data-path="/druck-kosten , /druck-kosten.html"><span class="nav-ico" aria-hidden="true">üßÆ</span>Kosten &amp; Kalkulation</a>
                </li>
                <li>
                  <a class="nav-link" href="/ablauf-anfrage.html" data-nav-link data-path="/ablauf-anfrage , /ablauf-anfrage.html"><span class="nav-ico" aria-hidden="true">üìù</span>Ablauf &amp; Anfrage</a>
                </li>
                <li>
                  <a class="nav-link" href="/slicer-einstellungen.html" data-nav-link data-path="/slicer-einstellungen , /slicer-einstellungen.html"><span class="nav-ico" aria-hidden="true">‚öôÔ∏è</span>Slicer &amp; Einstellungen</a>
                </li>
                <li>
                  <a class="nav-link" href="/3ddruck-faq.html" data-nav-link data-path="/3ddruck-faq , /3ddruck-faq.html"><span class="nav-ico" aria-hidden="true">‚ùì</span>FAQ &amp; Einstieg</a>
                </li>
                <li>
                  <a class="nav-link" href="/wartung-reinigung.html" data-nav-link data-path="/wartung-reinigung , /wartung-reinigung.html"><span class="nav-ico" aria-hidden="true">üßº</span>Wartung &amp; Reinigung</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>

      <div class="header-actions">
        <button class="theme-toggle" type="button" id="themeToggleBtn" aria-label="Theme wechseln" title="Theme wechseln">
          <span id="themeIcon" aria-hidden="true">üñ•Ô∏è</span>
          <span class="sr-only theme-toggle__label">Aktuelles Theme: Systemeinstellung</span>
        </button>

        <button class="nav-toggle" type="button" aria-controls="primary-navigation" aria-expanded="false" data-nav-toggle>
          <span class="sr-only">Men√º √∂ffnen</span>
          <span class="nav-toggle-bar" aria-hidden="true"></span>
          <span class="nav-toggle-bar" aria-hidden="true"></span>
          <span class="nav-toggle-bar" aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </header>

  <nav class="breadcrumbs no-print" aria-label="Brotkrumen">
    <div class="container breadcrumbs__container">
      <ol class="breadcrumbs__list">
        <li class="breadcrumbs__item"><a href="/index.html">Start</a></li>
        <li class="breadcrumbs__item"><a href="/leistungen/3d-druck.html">3D-Druck</a></li>
        <li class="breadcrumbs__item" aria-current="page"><span class="nav-ico" aria-hidden="true">üßÆ</span>Kosten & Kalkulation</li>
      </ol>
    </div>
  </nav>

  <main id="druck-kosten" class="site-main no-print" tabindex="-1">
    <section class="section about-hero" aria-labelledby="kosten-heading">
      <div class="container about-hero__grid">
        <div class="about-hero__content">
          <p class="section-eyebrow">Kosten &amp; Kalkulation</p>
          <h1 id="kosten-heading">3D-Druck-Kosten grob einsch√§tzen</h1>
          <p>Mit diesem Rechner bekommst du eine unverbindliche Hausnummer f√ºr Material- und Energiekosten ‚Äì ideal f√ºr die erste Planung vor dem Angebot.</p>
          <div class="hero-actions">
            <a class="btn btn-primary" href="#calcForm">Kosten berechnen</a>
            <a class="btn btn-outline" href="/kontakt.html#kontakt-heading">Projekt anfragen</a>
          </div>
        </div>
      </div>
    </section>

    <section class="section" aria-labelledby="rechner-heading">
      <div class="container container--calc-wide">
        <div class="section-heading">
          <h2 id="rechner-heading">Kostenrechner f√ºr Filamentdruck</h2>
          <p>W√§hle Material, gib Gewicht oder L√§nge ein und erg√§nze Laufzeit sowie Stromkosten ‚Äì der Rest passiert automatisch.</p>
        </div>
        <div class="cost-layout">
          <div class="card" id="calculatorCard">
            <h2 class="calc-card__title">Standard-Rechner</h2>
            <form class="calc-form" id="calcForm" novalidate>
              <div id="std-fields">
                <div class="calc-pro-toggle">
                  <label class="calc-toggle">
                    <input class="calc-toggle__input" type="checkbox" id="proToggle" name="proToggle" aria-controls="pro-fields" aria-expanded="false">
                    <span class="calc-toggle__track" aria-hidden="true">
                      <span class="calc-toggle__thumb"></span>
                    </span>
                    <span class="calc-toggle__text">
                      <span class="calc-toggle__title">Pro-Optionen</span>
                      <span class="calc-toggle__hint">Zusatzfelder f√ºr professionelle Kalkulation.</span>
                    </span>
                  </label>
                </div>

                <div class="calc-field">
                  <label for="partName">Teilename / Projekt</label>
                  <input type="text" id="partName" name="partName" maxlength="80" placeholder="z. B. Motorhalterung V2">
                </div>

                <div class="calc-field">
                  <label for="materialSelect">Material</label>
                  <select id="materialSelect" name="material">
                    <option value="PLA">PLA</option>
                    <option value="PLA_PLUS">PLA+</option>
                    <option value="PLA_SILK">PLA Silk</option>
                    <option value="PETG">PETG</option>
                    <option value="PETG_CF">PETG-CF</option>
                    <option value="ABS">ABS</option>
                    <option value="ABS_CF">ABS-CF</option>
                    <option value="ASA">ASA</option>
                    <option value="ASA_CF">ASA-CF</option>
                    <option value="TPU">TPU</option>
                    <option value="PA">Nylon (PA)</option>
                  </select>
                  <p class="calc-hint" id="materialDensityHint" aria-live="polite">Richtwert: 2,98&nbsp;g/m (PLA)</p>
                </div>

                <div class="calc-field">
                  <label for="pricePerKg">Materialpreis (‚Ç¨/kg)</label>
                  <div class="calc-price-input-row">
                    <input class="calc-price-input" type="number" id="pricePerKg" name="pricePerKg" min="0" step="0.10" inputmode="decimal" placeholder="z. B. 20">
                    <button type="button" class="calc-price-suggestion is-hidden" id="priceSuggestionButton">
                      Vorschlag einsetzen
                      <span class="sr-only" id="priceSuggestionSrText"></span>
                    </button>
                  </div>
                </div>

                <fieldset class="calc-fieldset">
                  <legend class="sr-only">Berechnungsgrundlage</legend>
                  <div class="calc-mode" role="group" aria-label="Berechnungsgrundlage w√§hlen">
                    <div>
                      <input class="calc-mode__input" type="radio" id="modeWeight" name="mode" value="weight" checked>
                      <label class="calc-mode__label" for="modeWeight">Bauteilgewicht</label>
                    </div>
                    <div>
                      <input class="calc-mode__input" type="radio" id="modeLength" name="mode" value="length">
                      <label class="calc-mode__label" for="modeLength">Filamentl√§nge</label>
                    </div>
                  </div>
                  <div class="calc-field" data-field="weight">
                    <label for="partWeight">Materialgewicht (g)</label>
                    <input type="number" id="partWeight" name="partWeight" min="0" step="1" inputmode="decimal" placeholder="z. B. 200">
                  </div>
                  <div class="calc-field" data-field="length">
                    <label for="filamentLength">Filamentl√§nge in Metern</label>
                    <input type="number" id="filamentLength" name="filamentLength" min="0" step="0.1" inputmode="decimal" placeholder="z. B. 32">
                  </div>
                </fieldset>

                <div class="calc-field">
                  <label for="wastePercent">Verschnitt (%)</label>
                  <input type="number" id="wastePercent" name="wastePercent" min="0" max="100" step="1" inputmode="decimal" placeholder="z. B. 10">
                </div>

                <div class="calc-inline">
                  <div class="calc-field">
                    <label for="printTime">Druckzeit (hh:mm)</label>
                    <input type="time" id="printTime" name="printTime" step="60" placeholder="05:00">
                  </div>
                  <div class="calc-field">
                    <label for="powerDraw">Leistung (W)</label>
                    <input type="number" id="powerDraw" name="powerDraw" min="0" step="10" placeholder="z. B. 150">
                    <p class="calc-hint">Wird erst ber√ºcksichtigt, wenn du einen Wert eingibst.</p>
                  </div>
                  <div class="calc-field">
                  <label for="energyPrice">Strompreis (‚Ç¨/kWh)</label>
                    <input type="number" id="energyPrice" name="energyPrice" min="0" step="0.01" inputmode="decimal" placeholder="z. B. 0,30">
                    <p class="calc-hint">Wird erst ber√ºcksichtigt, wenn du einen Wert eingibst.</p>
                  </div>
                  <div class="calc-field">
                  <label for="loadFactor">Lastfaktor (%)</label>
                    <input type="number" id="loadFactor" name="loadFactor" min="0" max="100" step="1" placeholder="z. B. 80">
                    <p class="calc-hint">Wird erst ber√ºcksichtigt, wenn du einen Wert eingibst.</p>
                  </div>
                </div>
              </div>

            </form>
          </div>

          <aside class="card calc-pro-card" id="proCard" hidden aria-hidden="true">
            <div class="calc-pro-card__header">
              <div class="calc-pro-card__heading">
                <h2 class="calc-card__title">Pro-Optionen</h2>
                <p class="calc-pro-card__description">Zusatzfelder f√ºr professionelle Kalkulation.</p>
              </div>
              <button type="button" class="calc-pro-card__toggle" id="proCollapseToggle" aria-expanded="true">
                Bereiche ausblenden
              </button>
            </div>
            <div class="calc-pro-card__body" id="proCardBody">
              <section class="calc-pro" id="pro-fields" hidden aria-hidden="true" inert>
                <p class="calc-hint calc-hint--lead">Kostenfaktoren f√ºr professionelle Kalkulation. Wirken nur, wenn aktiviert.</p>
                <div class="calc-pro__group">
                  <h3 class="calc-pro__subheading">Kostenaufschl√§ge</h3>
                  <div class="calc-pro__grid">
                    <div class="calc-field">
                      <label for="profitMargin">Gewinnmarge (%)</label>
                      <input type="number" id="profitMargin" name="profitMargin" min="0" max="100" step="0.5" inputmode="decimal" placeholder="z. B. 10">
                      <p class="calc-hint">Aufschlag auf Material, Energie, Arbeitszeit &amp; Maschine.</p>
                    </div>
                    <div class="calc-field">
                      <label for="discountPercent">Rabatt (%)</label>
                      <input type="number" id="discountPercent" name="discountPercent" min="0" max="100" step="0.5" inputmode="decimal" placeholder="z. B. 0">
                      <p class="calc-hint">Abzug vor MwSt. auf die Zwischensumme.</p>
                    </div>
                    <div class="calc-field">
                      <label for="errorRate">Fehlerrate (%)</label>
                      <input type="number" id="errorRate" name="errorRate" min="0" max="100" step="0.5" inputmode="decimal" placeholder="z. B. 5">
                      <p class="calc-hint">Wirkt nur auf Material (inkl. Verschnitt).</p>
                    </div>
                  </div>
                </div>
                <div class="calc-pro__group">
                  <h3 class="calc-pro__subheading">Zeiten &amp; Lohn</h3>
                  <div class="calc-pro__grid">
                    <div class="calc-field">
                      <label for="hourlyRate">Stundenlohn (‚Ç¨/h)</label>
                      <input type="number" id="hourlyRate" name="hourlyRate" min="0" step="1" inputmode="decimal" placeholder="z. B. 20">
                      <p class="calc-hint">Wirkt auf R√ºstzeit + Nachbearbeitung.</p>
                    </div>
                    <div class="calc-field">
                      <label for="setupMinutes">R√ºstzeit (min)</label>
                      <input type="number" id="setupMinutes" name="setupMinutes" min="0" step="1" inputmode="decimal" placeholder="z. B. 10">
                      <p class="calc-hint">Vorbereitung &amp; Setup je Auftrag.</p>
                    </div>
                    <div class="calc-field">
                      <label for="finishingMinutes">Nachbearbeitung (min)</label>
                      <input type="number" id="finishingMinutes" name="finishingMinutes" min="0" step="1" inputmode="decimal" placeholder="z. B. 10">
                      <p class="calc-hint">Entgraten, Reinigen, Finish.</p>
                    </div>
                    <div class="calc-field">
                      <label for="proPrintMinutes">Druckzeit (min)</label>
                      <input type="number" id="proPrintMinutes" name="proPrintMinutes" min="0" step="1" inputmode="decimal" aria-describedby="hint-printMinutes">
                      <p class="calc-hint" id="hint-printMinutes">Synchronisiert mit der Laufzeit oben.</p>
                    </div>
                  </div>
                </div>
                <div class="calc-pro__group">
                  <h3 class="calc-pro__subheading">Fix &amp; Logistik</h3>
                  <div class="calc-pro__grid">
                    <div class="calc-field">
                      <label for="fixedCost">Fixkosten (‚Ç¨)</label>
                      <input type="number" id="fixedCost" name="fixedCost" min="0" step="0.5" inputmode="decimal" placeholder="z. B. 5">
                      <p class="calc-hint">Bleiben fix ‚Äì keine Marge darauf.</p>
                    </div>
                    <div class="calc-field">
                      <label for="packagingCost">Verpackung (‚Ç¨)</label>
                      <input type="number" id="packagingCost" name="packagingCost" min="0" step="0.5" inputmode="decimal" placeholder="z. B. 2">
                      <p class="calc-hint">Z√§hlt zu den Fixkosten je Auftrag.</p>
                    </div>
                    <div class="calc-field">
                      <label for="shippingCost">Versand (‚Ç¨)</label>
                      <input type="number" id="shippingCost" name="shippingCost" min="0" step="0.5" inputmode="decimal" placeholder="z. B. 5">
                      <p class="calc-hint">Z√§hlt zu den Fixkosten je Auftrag.</p>
                    </div>
                  </div>
                  <p class="calc-hint calc-hint--note">Fixkosten umfassen Verpackung &amp; Versand.</p>
                </div>
                <div class="calc-pro__group">
                  <h3 class="calc-pro__subheading">Maschine</h3>
                  <div class="calc-pro__grid">
                    <div class="calc-field calc-field--stacked">
                      <label for="machineHourlyRate">Maschinenkosten (‚Ç¨/h)</label>
                      <input type="number" id="machineHourlyRate" name="machineHourlyRate" min="0" step="0.5" inputmode="decimal" placeholder="z. B. 1.5">
                      <p class="calc-hint">Wirkt direkt auf die Druckzeit.</p>
                      <details class="calc-pro-advanced" id="machineAdvanced">
                        <summary>Anschaffung &amp; Lebensdauer hinterlegen</summary>
                        <div class="calc-pro-advanced__grid">
                          <div class="calc-field">
                            <label for="machinePurchase">Anschaffungswert (‚Ç¨)</label>
                            <input type="number" id="machinePurchase" name="machinePurchase" min="0" step="50" inputmode="decimal" placeholder="z. B. 1200">
                          </div>
                          <div class="calc-field">
                            <label for="machineLifetime">Lebensdauer (h)</label>
                            <input type="number" id="machineLifetime" name="machineLifetime" min="0" step="50" inputmode="decimal" placeholder="z. B. 4000">
                          </div>
                        </div>
                        <p class="calc-hint" id="machineAutoHint">Ergibt automatisch einen ‚Ç¨/h-Wert.</p>
                      </details>
                    </div>
                  </div>
                </div>
                <div class="calc-pro__group">
                  <h3 class="calc-pro__subheading">Materialdaten</h3>
                  <div class="calc-pro__grid">
                    <div class="calc-field">
                      <label for="materialDensity">Dichte (g/cm¬≥)</label>
                      <input type="number" id="materialDensity" name="materialDensity" min="0" step="0.01" inputmode="decimal" placeholder="z. B. 1.24">
                      <p class="calc-hint" id="materialDensityNote">F√ºr Filamentl√§nge ‚Üí Gewicht (√ò 1,75&nbsp;mm).</p>
                      <button type="button" class="calc-reset-link is-hidden" id="materialDensityReset">Preset-Dichte wiederherstellen</button>
                    </div>
                  </div>
                </div>
              </section>
            </div>
          </aside>

          <div class="card calc-results" aria-live="polite">
            <div class="calc-results__header">
              <h2>Ergebnis</h2>
              <p class="calc-meta" id="calcMeta">Gewicht: 0&nbsp;g ¬∑ L√§nge: 0,00&nbsp;m</p>
            </div>
            <div class="calc-results__actions">
              <button type="button" class="btn btn-outline" id="printResultButton">Ergebnis drucken</button>
              <button type="button" class="btn btn-outline" id="printFullButton">Ergebnis + Eingaben drucken</button>
            </div>
            <label class="calc-checkbox calc-checkbox--vat" for="includeVat">
              <input type="checkbox" id="includeVat" name="includeVat" value="true">
              <span>Preise inkl. MwSt.</span>
            </label>
            <ul class="calc-results__list">
              <li class="calc-results__item">
                <span class="calc-results__label" id="materialCostLabel">Material (Basis)</span>
                <span class="calc-results__value" id="materialCost">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item" data-result="materialWaste">
                <span class="calc-results__label">Verschnitt</span>
                <span class="calc-results__value" id="materialWasteCost">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item" data-result="materialTotal">
                <span class="calc-results__label">Material (inkl. Verschnitt &amp; Fehlerrate)</span>
                <span class="calc-results__value" id="materialTotalCost">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item">
                <span class="calc-results__label" id="energyCostLabel">Energiekosten</span>
                <span class="calc-results__value" id="energyCost">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item calc-results__item--pro" data-result="timeCost" data-pro-row="true" hidden>
                <span class="calc-results__label">Arbeitszeitkosten (R√ºstzeit + Nachbearbeitung)</span>
                <span class="calc-results__value" id="timeCost">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item calc-results__item--pro" data-result="machineCost" data-pro-row="true" hidden>
                <span class="calc-results__label">Maschinenkosten</span>
                <span class="calc-results__value" id="machineCostValue">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item calc-results__item--pro" data-result="fixedCost" data-pro-row="true" hidden>
                <span class="calc-results__label">Fixkosten (inkl. Verpackung/Versand)</span>
                <span class="calc-results__value" id="fixedCostValue">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item" data-result="subtotal">
                <span class="calc-results__label">Zwischensumme</span>
                <span class="calc-results__value" id="subtotalValue">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item calc-results__item--pro" data-result="margin" data-pro-row="true" hidden>
                <span class="calc-results__label">Marge</span>
                <span class="calc-results__value" id="marginValue">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item calc-results__item--pro" data-result="discount" data-pro-row="true" hidden>
                <span class="calc-results__label">Rabatt</span>
                <span class="calc-results__value calc-results__value--deduction" id="discountValue">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item">
                <span class="calc-results__label">Gesamtkosten (netto)</span>
                <span class="calc-results__value calc-results__value--accent" id="totalNet">0,00&nbsp;‚Ç¨</span>
              </li>
              <li class="calc-results__item">
                <span class="calc-results__label" id="grossLabel">Gesamtkosten (brutto)</span>
                <span class="calc-results__value" id="totalGross">0,00&nbsp;‚Ç¨</span>
              </li>
            </ul>
            <div class="co2" id="co2Output" hidden>
              üåø CO‚ÇÇ-Bilanz: <strong id="co2Value">0,0&nbsp;g</strong>
            </div>
            <section class="result-chart" aria-label="Kostenverteilung" id="resultChart" hidden>
              <header class="result-chart__header">
                <span class="result-chart__title">Visualisierung</span>
                <label class="chart-toggle" for="resultChartToggle">
                  <input type="checkbox" id="resultChartToggle" name="resultChartToggle" aria-controls="resultChart" checked>
                  <span>Diagramm anzeigen</span>
                </label>
              </header>
              <div class="bars" role="list" id="resultChartBars"></div>
              <div class="chart-legend">
                <span class="chip chip-material">Material</span>
                <span class="chip chip-energy">Energie</span>
                <span class="chip chip-labor">Arbeitszeit</span>
                <span class="chip chip-machine">Maschine</span>
                <span class="chip chip-fix">Fixkosten</span>
                <span class="chip chip-margin">Marge</span>
                <span class="chip chip-discount">Rabatt</span>
              </div>
              <p class="chart-total" id="chartNetTotal">Gesamtkosten (netto): 0,00&nbsp;‚Ç¨</p>
            </section>
            <p class="calc-results__pro-hint" id="proStatus" data-pro-row="true" hidden>Pro-Optionen aktiv ‚Äì Maschine, Arbeitszeit &amp; Fixkosten werden ber√ºcksichtigt.</p>
            <h3 class="calc-results__subheading">Disclaimer</h3>
            <p class="calc-formula">Energiekosten = (Watt/1000) √ó Laufzeit √ó ‚Ç¨/kWh √ó Lastfaktor (Sch√§tzung).</p>
            <p class="calc-note">Unverbindliche Orientierung ohne Design- oder Nachbearbeitungskosten. Tats√§chliche Kosten k√∂nnen abweichen.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section" aria-labelledby="guide-heading">
      <div class="container">
        <div class="card">
          <h2 id="guide-heading">Was macht der Kostenrechner?</h2>
          <p>Der Warenschmiede-Rechner sch√§tzt die Herstellungskosten f√ºr FDM-3D-Drucke. Er ber√ºcksichtigt Material, Energie und ‚Äì im Erweiterten Modus ‚Äì Arbeitszeit, Fixkosten, Marge und Rabatt. Ergebnis: Netto und Brutto/&sect;19 UStG (Kleinunternehmer).</p>

          <h3 id="standard-guide">So gehst du vor &ndash; Standard</h3>
          <ol>
            <li>Material w√§hlen (z. B. PLA).</li>
            <li>Materialpreis eintragen (&euro;/kg). Tipp: steht auf der Filamentrolle/Rechnung.</li>
            <li>Entweder Bauteilgewicht (g) oder Filamentl√§nge (m) angeben.</li>
            <li>Optional: Verschnitt&nbsp;% (Reste, Support).</li>
            <li>Druckzeit, Leistung (W), Strompreis (&euro;/kWh), Lastfaktor&nbsp;% eintragen, um Energiekosten zu berechnen.
              <ul>
                <li>Leistung (W): Typenschild/Netzteil oder Energiekosten-Messger√§t.</li>
                <li>Lastfaktor: durchschnittliche Auslastung w√§hrend des Drucks (z. B. 80&nbsp;%).</li>
              </ul>
            </li>
            <li>Ergebnis ansehen oder Ergebnis drucken (A4).</li>
          </ol>

          <h3 id="pro-guide">Pro-Optionen</h3>
          <p>Aktiviere die &bdquo;Pro-Optionen&ldquo;, wenn du zus√§tzlich kalkulieren willst:</p>
          <ul>
            <li>R√ºstzeit (min): Vorbereitung, Einrichten, Start.</li>
            <li>Nachbearbeitung (min): Entgraten, Reinigen, Montage.</li>
            <li>Stundenlohn (&euro;/h): wirkt nur auf R√ºstzeit + Nachbearbeitung.</li>
            <li>Maschinenkosten (&euro;/h): wirken auf die Druckzeit (optional via Anschaffung/Lebensdauer).</li>
            <li>Fixkosten (&euro;): feste Kosten pro Auftrag inkl. Verpackung &amp; Versand.</li>
            <li>Fehlerrate (%): Zuschlag auf Material inkl. Verschnitt.</li>
            <li>Gewinnmarge (%): Aufschlag auf Material, Energie, Arbeitszeit &amp; Maschine. Fixkosten bleiben fix.</li>
            <li>Rabatt (%): optionaler Abzug vor MwSt.</li>
            <li>Dichte (g/cm¬≥): konvertiert Filamentl√§nge (√ò 1,75&nbsp;mm) zu Gewicht.</li>
          </ul>
          <p>Nutze anschlie√üend &bdquo;Ergebnis + Eingaben drucken&ldquo; (2 Seiten: Ergebnis + Eingaben).</p>

          <h3 id="limits-guide">Hinweise &amp; Grenzen</h3>
          <ul>
            <li>Werte sind Sch√§tzungen; tats√§chliche Kosten k√∂nnen abweichen (Geometrie, Support, Oberfl√§che).</li>
            <li>F√ºr ASA/ABS empfehlen wir ein geschlossenes Geh√§use (konstante Bedingungen).</li>
            <li>F√ºr lange Drucke ist ein Energiekosten-Messger√§t sinnvoll.</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="section" aria-labelledby="features-heading">
      <div class="container">
        <div class="card card--narrow">
          <h2 id="features-heading">Funktionen erkl√§rt</h2>
          <dl class="calc-feature-list">
            <dt>Material</dt>
            <dd>W√§hle das Filament (z. B. PLA, PETG, ASA, Nylon). Die Auswahl setzt ‚Äì falls leer ‚Äì einen Richtwert f√ºr den Materialpreis.</dd>

            <dt>Materialpreis (‚Ç¨/kg)</dt>
            <dd>Preis der Filamentrolle pro Kilogramm. Wert steht auf der Rolle/Rechnung und ist frei √§nderbar.</dd>

            <dt>Bauteilgewicht (g) / Filamentl√§nge (m)</dt>
            <dd>Gib entweder das Bauteilgewicht oder die entsprechende Filamentl√§nge an. Das Gewicht kannst du im Slicer (z. B. Bambu Studio) ablesen.</dd>

            <dt>Verschnitt (%)</dt>
            <dd>Anteil f√ºr Reste, Brim/Skirt, St√ºtzstrukturen. Typisch 5‚Äì15 %.</dd>

            <dt>Druckzeit (hh:mm)</dt>
            <dd>Geplante Laufzeit des Drucks. Nimm die Slicer-Sch√§tzung.</dd>

            <dt>Leistung (W)</dt>
            <dd>
              <p>Elektrische Leistungsaufnahme deines Druckers.</p>
              <p><strong>So ermittelst du sie:</strong> Typenschild/Netzteil ablesen oder mit einem Energiekosten-Messger√§t messen.</p>
            </dd>

            <dt>Strompreis (‚Ç¨/kWh)</dt>
            <dd>Aktueller Tarif deines Anbieters.</dd>

            <dt>Lastfaktor (%)</dt>
            <dd>Durchschnittliche Auslastung w√§hrend des Drucks (nicht immer 100 %). Beispiel: 80 % bedeutet, dass Heizung/L√ºfter/Bewegung im Mittel bei 0,8√óLeistung laufen.</dd>
          </dl>

          <h3>Pro-Optionen (optional)</h3>
          <p>Zusatzfelder f√ºr professionelle Kalkulation. Wirken nur, wenn der Schalter aktiv ist:</p>
          <ul>
            <li>R√ºstzeit (min): Vorbereitung, Einrichtung, Start.</li>
            <li>Nachbearbeitung (min): Support entfernen, Entgraten, Finish.</li>
            <li>Stundenlohn (‚Ç¨/h): Eigen-/Kalkulationslohn f√ºr R√ºstzeit + Nachbearbeitung (wirkt nur auf diese beiden Zeiten).</li>
            <li>Maschinenkosten (‚Ç¨/h): Wirken auf die Druckzeit, optional aus Anschaffung &amp; Lebensdauer berechnet.</li>
            <li>Fixkosten (‚Ç¨): Feste Kosten pro Auftrag (inkl. Verpackung &amp; Versand). Bleiben fix ‚Äì werden nicht durch Marge erh√∂ht.</li>
            <li>Fehlerrate (%): Zuschlag auf Material (inkl. Verschnitt).</li>
            <li>Gewinnmarge (%): Aufschlag auf Material, Energie, Arbeitszeit &amp; Maschine.</li>
            <li>Rabatt (%): Optionaler Abzug vor MwSt.</li>
            <li>Dichte (g/cm¬≥): F√ºr die Umrechnung Filamentl√§nge ‚Üí Gewicht (√ò 1,75&nbsp;mm).</li>
          </ul>

          <h3>Ergebnisfelder</h3>
          <ul>
            <li>Material (Basis) + Verschnitt ‚Üí Material (inkl. Verschnitt)</li>
            <li>Energiekosten = (Watt/1000) √ó Laufzeit √ó ‚Ç¨/kWh √ó Lastfaktor</li>
            <li>Arbeitszeitkosten = (R√ºstzeit + Nachbearbeitung) √ó (Stundenlohn/60)</li>
            <li>Zwischensumme = Material inkl. Verschnitt + Energie + Arbeitszeit</li>
            <li>Marge/Rabatt/Fixkosten gem√§√ü Eingaben</li>
            <li>Gesamtkosten (netto) und Brutto (bei ¬ß 19 UStG ohne MwSt.)</li>
          </ul>

          <h3>Drucken / Speichern</h3>
          <p>Ergebnis drucken: 1 Seite mit der Aufschl√ºsselung.</p>
          <p>Ergebnis + Eingaben drucken: 2 Seiten (Ergebnis + deine Eingaben). Die Druckansicht ist f√ºr A4 optimiert.</p>
        </div>
      </div>
    </section>

    <section class="section" aria-labelledby="cta-kosten-heading">
      <div class="container">
        <div class="card">
          <h2 id="cta-kosten-heading">Weiter planen &amp; anfragen</h2>
          <p><a href="/ablauf-anfrage.html">Zum Ablauf &amp; Anfrage</a></p>
          <p><a href="/material.html">Materialwissen &amp; Vergleiche ansehen</a></p>
          <p><a href="/kontakt.html#kontakt-heading">Direkt Kontakt aufnehmen</a></p>
        </div>
      </div>
    </section>

    <nav class="section page-links" aria-label="Weiterf√ºhrende Seiten">
      <div class="container">
        <p class="page-links__text">Mehr wissen: <a href="/material.html">Materialwissen</a> &middot; <a href="/druck-tipps.html">Tipps &amp; Abl√§ufe</a> &middot; <a href="/slicer-einstellungen.html">Slicer &amp; Einstellungen</a></p>
      </div>
    </nav>
  </main>

  <section class="calc-print print-only" id="printSummary" aria-hidden="true">
    <div class="calc-print__page" data-page="result">
      <header class="calc-print__header">
        <div class="calc-print__header-left">
          <h1 class="calc-print__title">3D-Druck Rechner ‚Äì Ergebnis</h1>
          <p class="calc-print__part" id="printHeaderPartName" hidden>Teilename: <span id="printHeaderPartNameValue"></span></p>
        </div>
        <div class="calc-print__header-right">
          <p class="calc-print__brand">Warenschmiede ¬∑ ¬© warenschmiede.com</p>
          <p class="calc-print__timestamp" id="printTimestamp"></p>
        </div>
      </header>

      <div class="calc-print__body">
        <div class="calc-print__result-grid">
          <section class="calc-print__summary" aria-labelledby="printSummaryHeading">
            <h2 class="sr-only" id="printSummaryHeading">Kosten√ºbersicht</h2>
            <div class="calc-print__total">
              <p class="calc-print__lead">Endsumme <span class="calc-print__total-note" id="printTotalContext"></span></p>
              <p class="calc-print__total-value" id="printTotal">0,00&nbsp;‚Ç¨</p>
              <p class="calc-print__vat-note" id="printVatNote">Hinweis: ¬ß19 UStG ‚Äì keine Umsatzsteuer.</p>
            </div>
            <dl class="calc-print__list">
              <div class="calc-print__item">
                <dt>Material (inkl. Verschnitt &amp; Fehlerrate)</dt>
                <dd id="printMaterialTotal">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item">
                <dt>Energie</dt>
                <dd id="printEnergyCost">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item" data-pro-row="true">
                <dt>Arbeitszeit</dt>
                <dd id="printTimeCost">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item" data-pro-row="true">
                <dt>Maschine</dt>
                <dd id="printMachineCost">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item" data-pro-row="true">
                <dt>Fixkosten (inkl. Verpackung/Versand)</dt>
                <dd id="printFixedCost">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item" data-pro-row="true">
                <dt>Marge</dt>
                <dd id="printMargin">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item" data-pro-row="true">
                <dt>Rabatt</dt>
                <dd id="printDiscount">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item">
                <dt>Zwischensumme</dt>
                <dd id="printSubtotal">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item">
                <dt>Gesamtkosten (netto)</dt>
                <dd id="printNet">0,00&nbsp;‚Ç¨</dd>
              </div>
              <div class="calc-print__item">
                <dt>Gesamtkosten (brutto)</dt>
                <dd id="printGross">0,00&nbsp;‚Ç¨</dd>
              </div>
            </dl>
          </section>
          <aside class="calc-print__chart" id="printChartSection" aria-labelledby="printChartTitle">
            <h2 class="calc-print__chart-title" id="printChartTitle">Kostenanteile</h2>
            <div class="calc-print__chart-bars" id="printChartBars" role="list"></div>
            <p class="calc-print__chart-note" id="printChartTotal">Gesamtkosten (netto): 0,00&nbsp;‚Ç¨</p>
          </aside>
        </div>
      </div>

      <footer class="calc-print__footer">
        <p>Unverbindliche Kalkulation ‚Äì Werte k√∂nnen abweichen.</p>
      </footer>
    </div>

    <div class="calc-print__page" data-page="inputs">
      <section class="calc-print__section" id="printInputsSection">
        <div class="calc-print__section-header">
          <h2 class="calc-print__heading">Eingaben</h2>
          <p class="calc-print__section-note" id="printInputsPartName" hidden>Teilename: <span id="printInputsPartNameValue"></span></p>
        </div>
        <div class="calc-print__inputs-grid">
          <table class="calc-print__table" id="printInputsTable">
            <tbody>
              <tr>
                <th scope="row">Material</th>
                <td id="printMaterial">PLA</td>
              </tr>
              <tr>
                <th scope="row">Materialpreis</th>
                <td id="printMaterialPrice">0,00&nbsp;‚Ç¨/kg</td>
              </tr>
              <tr>
                <th scope="row">Berechnungsgrundlage</th>
                <td id="printMode">Bauteilgewicht</td>
              </tr>
              <tr data-input-row="weight">
                <th scope="row">Bauteilgewicht</th>
                <td id="printWeight">0&nbsp;g</td>
              </tr>
              <tr data-input-row="length">
                <th scope="row">Filamentl√§nge</th>
                <td id="printLength">0,00&nbsp;m</td>
              </tr>
              <tr data-input-row="duration">
                <th scope="row">Druckzeit</th>
                <td id="printDuration">0&nbsp;min</td>
              </tr>
              <tr data-input-row="power">
                <th scope="row">Leistung</th>
                <td id="printPower">0&nbsp;W</td>
              </tr>
              <tr data-input-row="energyPrice">
                <th scope="row">Strompreis</th>
                <td id="printEnergyPrice">0,00&nbsp;‚Ç¨/kWh</td>
              </tr>
              <tr data-input-row="loadFactor">
                <th scope="row">Lastfaktor</th>
                <td id="printLoadFactor">0&nbsp;%</td>
              </tr>
              <tr data-input-row="wastePercent">
                <th scope="row">Verschnitt</th>
                <td id="printWastePercent">0&nbsp;%</td>
              </tr>
            </tbody>
          </table>

          <table class="calc-print__table" id="printProParams" data-pro-row="true">
            <tbody>
              <tr data-input-row="profitMargin">
                <th scope="row">Gewinnmarge</th>
                <td id="printProfitMargin">0&nbsp;%</td>
              </tr>
              <tr data-input-row="discountPercent">
                <th scope="row">Rabatt</th>
                <td id="printDiscountPercent">0&nbsp;%</td>
              </tr>
              <tr data-input-row="errorRate">
                <th scope="row">Fehlerrate</th>
                <td id="printErrorRate">0&nbsp;%</td>
              </tr>
              <tr data-input-row="hourlyRate">
                <th scope="row">Stundenlohn</th>
                <td id="printHourlyRate">0,00&nbsp;‚Ç¨/h</td>
              </tr>
              <tr data-input-row="setupMinutes">
                <th scope="row">R√ºstzeit</th>
                <td id="printSetupMinutes">0&nbsp;min</td>
              </tr>
              <tr data-input-row="printMinutes">
                <th scope="row">Druckzeit (Minuten)</th>
                <td id="printProPrintMinutes">0&nbsp;min</td>
              </tr>
              <tr data-input-row="finishingMinutes">
                <th scope="row">Nachbearbeitung</th>
                <td id="printFinishingMinutes">0&nbsp;min</td>
              </tr>
              <tr data-input-row="fixedCost">
                <th scope="row">Fixkosten pro Auftrag</th>
                <td id="printFixedCostInput">0,00&nbsp;‚Ç¨</td>
              </tr>
              <tr data-input-row="packagingCost">
                <th scope="row">Verpackung</th>
                <td id="printPackagingCost">0,00&nbsp;‚Ç¨</td>
              </tr>
              <tr data-input-row="shippingCost">
                <th scope="row">Versand</th>
                <td id="printShippingCost">0,00&nbsp;‚Ç¨</td>
              </tr>
              <tr data-input-row="machineHourlyRate">
                <th scope="row">Maschinenkosten</th>
                <td id="printMachineHourly">0,00&nbsp;‚Ç¨/h</td>
              </tr>
              <tr data-input-row="machinePurchase">
                <th scope="row">Anschaffungswert</th>
                <td id="printMachinePurchase">0,00&nbsp;‚Ç¨</td>
              </tr>
              <tr data-input-row="machineLifetime">
                <th scope="row">Lebensdauer</th>
                <td id="printMachineLifetime">0&nbsp;h</td>
              </tr>
              <tr data-input-row="materialDensity">
                <th scope="row">Dichte</th>
                <td id="printMaterialDensity">0,00&nbsp;g/cm¬≥</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </section>

    <footer class="footer no-print">
    <div class="container">
      <div class="footer__inner">
        <div class="footer__brand">¬© 2025 Warenschmiede ¬∑ Alle Rechte vorbehalten.</div>
        <nav class="footer__links" aria-label="Rechtliches &amp; Kontakt">
          <a href="/index.html#impressum">Impressum</a>
          <a href="/index.html#datenschutz">Datenschutzerkl√§rung</a>
          <a href="/kontakt.html">Kontakt</a>
        </nav>
        <div class="footer__notes">
          <p><strong>Haftung / Nutzung:</strong> Alle Angaben ohne Gew√§hr ‚Äì Nutzung auf eigene Verantwortung.</p>
          <p><strong>Cookies:</strong> Diese Website verwendet keine Cookies oder Tracking.</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="assets/js/theme.js" defer></script>
  <script src="assets/js/header.js" defer></script>
  <script src="assets/js/whatsapp.js" defer></script>
  <script>
    (function () {
      var materialSelect = document.getElementById('materialSelect');
      var materialDensityHint = document.getElementById('materialDensityHint');
      var materialDensityResetButton = document.getElementById('materialDensityReset');
      var pricePerKgInput = document.getElementById('pricePerKg');
      var priceSuggestionButton = document.getElementById('priceSuggestionButton');
      var priceSuggestionSrText = document.getElementById('priceSuggestionSrText');
      var weightInput = document.getElementById('partWeight');
      var lengthInput = document.getElementById('filamentLength');
      var weightMode = document.getElementById('modeWeight');
      var lengthMode = document.getElementById('modeLength');
      var weightField = document.querySelector('[data-field="weight"]');
      var lengthField = document.querySelector('[data-field="length"]');
      var timeInput = document.getElementById('printTime');
      var powerInput = document.getElementById('powerDraw');
      var energyPriceInput = document.getElementById('energyPrice');
      var loadFactorInput = document.getElementById('loadFactor');
      var vatCheckbox = document.getElementById('includeVat');
      var materialCostOutput = document.getElementById('materialCost');
      var energyCostOutput = document.getElementById('energyCost');
      var totalNetOutput = document.getElementById('totalNet');
      var totalGrossOutput = document.getElementById('totalGross');
      var grossLabelOutput = document.getElementById('grossLabel');
      var metaOutput = document.getElementById('calcMeta');
      var materialCostLabelOutput = document.getElementById('materialCostLabel');
      var energyCostLabelOutput = document.getElementById('energyCostLabel');
      var co2Output = document.getElementById('co2Output');
      var co2ValueOutput = document.getElementById('co2Value');
      var materialWasteRow = document.querySelector('[data-result="materialWaste"]');
      var materialWasteOutput = document.getElementById('materialWasteCost');
      var materialTotalRow = document.querySelector('[data-result="materialTotal"]');
      var materialTotalOutput = document.getElementById('materialTotalCost');
      var timeCostRow = document.querySelector('[data-result="timeCost"]');
      var timeCostOutput = document.getElementById('timeCost');
      var machineCostOutput = document.getElementById('machineCostValue');
      var fixedCostRow = document.querySelector('[data-result="fixedCost"]');
      var fixedCostOutput = document.getElementById('fixedCostValue');
      var subtotalRow = document.querySelector('[data-result="subtotal"]');
      var subtotalOutput = document.getElementById('subtotalValue');
      var marginRow = document.querySelector('[data-result="margin"]');
      var marginOutput = document.getElementById('marginValue');
      var discountRow = document.querySelector('[data-result="discount"]');
      var discountOutput = document.getElementById('discountValue');
      var resultChartSection = document.getElementById('resultChart');
      var resultChartBars = document.getElementById('resultChartBars');
      var resultChartToggle = document.getElementById('resultChartToggle');
      var chartNetTotalOutput = document.getElementById('chartNetTotal');
      var proStatusOutput = document.getElementById('proStatus');
      var printResultButton = document.getElementById('printResultButton');
      var printFullButton = document.getElementById('printFullButton');
      var proToggle = document.getElementById('proToggle');
      var proFields = document.getElementById('pro-fields');
      var proCard = document.getElementById('proCard');
      var proCardBody = document.getElementById('proCardBody');
      var proCollapseToggle = document.getElementById('proCollapseToggle');
      var proRows = document.querySelectorAll('[data-pro-row="true"]');
      var rootElement = document.documentElement;
      var profitMarginInput = document.getElementById('profitMargin');
      var hourlyRateInput = document.getElementById('hourlyRate');
      var setupMinutesInput = document.getElementById('setupMinutes');
      var proPrintMinutesInput = document.getElementById('proPrintMinutes');
      var finishingMinutesInput = document.getElementById('finishingMinutes');
      var wastePercentInput = document.getElementById('wastePercent');
      var fixedCostInput = document.getElementById('fixedCost');
      var discountPercentInput = document.getElementById('discountPercent');
      var partNameInput = document.getElementById('partName');

      var printMaterialOutput = document.getElementById('printMaterial');
      var printMaterialPriceOutput = document.getElementById('printMaterialPrice');
      var printModeOutput = document.getElementById('printMode');
      var printWeightOutput = document.getElementById('printWeight');
      var printLengthOutput = document.getElementById('printLength');
      var printTimeOutput = document.getElementById('printDuration');
      var printPowerOutput = document.getElementById('printPower');
      var printEnergyPriceOutput = document.getElementById('printEnergyPrice');
      var printLoadFactorOutput = document.getElementById('printLoadFactor');
      var printMaterialTotalOutput = document.getElementById('printMaterialTotal');
      var printEnergyCostOutput = document.getElementById('printEnergyCost');
      var printTimeCostOutput = document.getElementById('printTimeCost');
      var printFixedCostOutput = document.getElementById('printFixedCost');
      var printSubtotalOutput = document.getElementById('printSubtotal');
      var printMarginOutput = document.getElementById('printMargin');
      var printDiscountOutput = document.getElementById('printDiscount');
      var printNetOutput = document.getElementById('printNet');
      var printGrossOutput = document.getElementById('printGross');
      var printTotalOutput = document.getElementById('printTotal');
      var printResultGrid = document.querySelector('.calc-print__result-grid');
      var printSummaryItemTime = printTimeCostOutput ? printTimeCostOutput.closest('.calc-print__item') : null;
      var printSummaryItemMachine = null;
      var printSummaryItemFixed = printFixedCostOutput ? printFixedCostOutput.closest('.calc-print__item') : null;
      var printSummaryItemMargin = printMarginOutput ? printMarginOutput.closest('.calc-print__item') : null;
      var printSummaryItemDiscount = printDiscountOutput ? printDiscountOutput.closest('.calc-print__item') : null;
      var printMachineCostOutput = document.getElementById('printMachineCost');
      if (printMachineCostOutput) {
        printSummaryItemMachine = printMachineCostOutput.closest('.calc-print__item');
      }
      var printErrorRateOutput = document.getElementById('printErrorRate');
      var printPackagingCostOutput = document.getElementById('printPackagingCost');
      var printShippingCostOutput = document.getElementById('printShippingCost');
      var printMachineHourlyOutput = document.getElementById('printMachineHourly');
      var printMachinePurchaseOutput = document.getElementById('printMachinePurchase');
      var printMachineLifetimeOutput = document.getElementById('printMachineLifetime');
      var printMaterialDensityOutput = document.getElementById('printMaterialDensity');
      var printHeaderPartName = document.getElementById('printHeaderPartName');
      var printHeaderPartNameValue = document.getElementById('printHeaderPartNameValue');
      var printInputsPartName = document.getElementById('printInputsPartName');
      var printInputsPartNameValue = document.getElementById('printInputsPartNameValue');
      var printTotalContextOutput = document.getElementById('printTotalContext');
      var printChartSection = document.getElementById('printChartSection');
      var printChartBarsOutput = document.getElementById('printChartBars');
      var printChartNoteOutput = document.getElementById('printChartTotal');
      var printVatNoteOutput = document.getElementById('printVatNote');
      var printTimestampOutput = document.getElementById('printTimestamp');
      var printInputsSection = document.getElementById('printInputsSection');
      var printInputsTable = document.getElementById('printInputsTable');
      var printProParamsSection = document.getElementById('printProParams');
      var printProfitMarginOutput = document.getElementById('printProfitMargin');
      var printHourlyRateOutput = document.getElementById('printHourlyRate');
      var printSetupMinutesOutput = document.getElementById('printSetupMinutes');
      var printProPrintMinutesOutput = document.getElementById('printProPrintMinutes');
      var printFinishingMinutesOutput = document.getElementById('printFinishingMinutes');
      var printWastePercentOutput = document.getElementById('printWastePercent');
      var printFixedCostInputOutput = document.getElementById('printFixedCostInput');
      var printDiscountPercentOutput = document.getElementById('printDiscountPercent');
      var printInputRows = {
        weight: printInputsTable ? printInputsTable.querySelector('[data-input-row="weight"]') : null,
        length: printInputsTable ? printInputsTable.querySelector('[data-input-row="length"]') : null,
        duration: printInputsTable ? printInputsTable.querySelector('[data-input-row="duration"]') : null,
        power: printInputsTable ? printInputsTable.querySelector('[data-input-row="power"]') : null,
        energyPrice: printInputsTable ? printInputsTable.querySelector('[data-input-row="energyPrice"]') : null,
        loadFactor: printInputsTable ? printInputsTable.querySelector('[data-input-row="loadFactor"]') : null,
        wastePercent: printInputsTable ? printInputsTable.querySelector('[data-input-row="wastePercent"]') : null
      };
      var printProInputRows = {
        profitMargin: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="profitMargin"]') : null,
        hourlyRate: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="hourlyRate"]') : null,
        setupMinutes: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="setupMinutes"]') : null,
        printMinutes: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="printMinutes"]') : null,
        finishingMinutes: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="finishingMinutes"]') : null,
        fixedCost: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="fixedCost"]') : null,
        discountPercent: printProParamsSection ? printProParamsSection.querySelector('[data-input-row="discountPercent"]') : null
      };
      var originalDocumentTitle = document.title;
      var pendingPrintTitle = null;

      var formatter = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });
      var decimalFormatter = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      var integerFormatter = new Intl.NumberFormat('de-DE', { maximumFractionDigits: 0 });
      var percentNumberFormatter = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 0, maximumFractionDigits: 1 });
      var chartCompactPercentFormatter = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
      var co2Formatter = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
      var FILAMENT_DIAMETER_MM = 1.75;

      var chartCollapseMediaQuery = window.matchMedia('(max-width: 359px)');
      var chartToggleInteracted = false;
      var proCardMediaQuery = window.matchMedia('(max-width: 1099px)');
      var proCardCollapsed = false;

      function setChartVisibility(expanded) {
        if (!resultChartSection) {
          return;
        }

        if (resultChartToggle) {
          resultChartToggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        }

        if (expanded) {
          resultChartSection.classList.remove('is-collapsed');
          resultChartSection.setAttribute('aria-hidden', 'false');
        } else {
          resultChartSection.classList.add('is-collapsed');
          resultChartSection.setAttribute('aria-hidden', 'true');
        }
      }

      function applyChartMediaPreference(event) {
        if (!resultChartToggle || chartToggleInteracted) {
          return;
        }

        var shouldCollapse = event.matches;
        resultChartToggle.checked = !shouldCollapse;
        setChartVisibility(!shouldCollapse);
      }

      function updateProCollapseToggle(collapsed) {
        if (!proCollapseToggle) {
          return;
        }
        var isCollapsed = !!collapsed;
        proCollapseToggle.setAttribute('aria-expanded', isCollapsed ? 'false' : 'true');
        proCollapseToggle.textContent = isCollapsed ? 'Bereiche anzeigen' : 'Bereiche ausblenden';
      }

      function syncProCardCollapseForViewport() {
        if (!proCard || !proModeEnabled) {
          if (proCard) {
            proCard.classList.remove('is-collapsed');
          }
          if (proCardBody) {
            proCardBody.setAttribute('aria-hidden', 'true');
          }
          updateProCollapseToggle(false);
          return;
        }

        var isMobile = proCardMediaQuery.matches;
        var shouldCollapse = isMobile && proCardCollapsed;
        proCard.classList.toggle('is-collapsed', shouldCollapse);
        if (proCardBody) {
          proCardBody.setAttribute('aria-hidden', shouldCollapse ? 'true' : 'false');
        }
        if (!isMobile) {
          updateProCollapseToggle(false);
        } else {
          updateProCollapseToggle(shouldCollapse);
        }
      }

      function setProCardCollapsedState(collapsed) {
        proCardCollapsed = !!collapsed;
        syncProCardCollapseForViewport();
      }

      if (resultChartToggle) {
        setChartVisibility(!chartCollapseMediaQuery.matches);
        resultChartToggle.checked = !chartCollapseMediaQuery.matches;
        resultChartToggle.addEventListener('change', function () {
          chartToggleInteracted = true;
          setChartVisibility(resultChartToggle.checked);
        });
        if (chartCollapseMediaQuery.addEventListener) {
          chartCollapseMediaQuery.addEventListener('change', applyChartMediaPreference);
        } else if (chartCollapseMediaQuery.addListener) {
          chartCollapseMediaQuery.addListener(applyChartMediaPreference);
        }
      }

      if (proCardMediaQuery.addEventListener) {
        proCardMediaQuery.addEventListener('change', function () {
          syncProCardCollapseForViewport();
        });
      } else if (proCardMediaQuery.addListener) {
        proCardMediaQuery.addListener(function () {
          syncProCardCollapseForViewport();
        });
      }
      var dateTimeFormatter = new Intl.DateTimeFormat('de-DE', { dateStyle: 'short', timeStyle: 'short' });

      function updateMaterialDensityResetState(defaults) {
        if (!materialDensityResetButton || !materialDensityInput) {
          return;
        }

        var defaultsSafe = defaults || currentMaterialDefaults || {};
        var hasDensityPreset = typeof defaultsSafe.density === 'number' && isFinite(defaultsSafe.density);
        if (!hasDensityPreset) {
          materialDensityResetButton.classList.add('is-hidden');
          return;
        }

        var currentValueRaw = materialDensityInput.value != null ? materialDensityInput.value.toString().trim() : '';
        var currentValue = parseFloat(currentValueRaw.replace(',', '.'));
        var differs = !isFinite(currentValue) || Math.abs(currentValue - defaultsSafe.density) > 0.001;
        if (differs) {
          materialDensityResetButton.classList.remove('is-hidden');
        } else {
          materialDensityResetButton.classList.add('is-hidden');
        }
      }

      function updateMaterialSuggestionState(defaults) {
        if (!priceSuggestionButton) {
          return;
        }

        var defaultsSafe = defaults || {};
        var hasPriceSuggestion = typeof defaultsSafe.price === 'number' && isFinite(defaultsSafe.price);
        var hasDensitySuggestion = typeof defaultsSafe.density === 'number' && isFinite(defaultsSafe.density);

        if (!hasPriceSuggestion && !hasDensitySuggestion) {
          updateMaterialDensityResetState(defaultsSafe);
          priceSuggestionButton.classList.add('is-hidden');
          priceSuggestionButton.dataset.suggestion = '';
          priceSuggestionButton.dataset.densitySuggestion = '';
          if (priceSuggestionSrText) {
            priceSuggestionSrText.textContent = '';
          }
          return;
        }

        priceSuggestionButton.dataset.suggestion = hasPriceSuggestion ? defaultsSafe.price.toString() : '';
        priceSuggestionButton.dataset.densitySuggestion = hasDensitySuggestion ? defaultsSafe.density.toString() : '';

        if (priceSuggestionSrText) {
          var srParts = [];
          if (hasPriceSuggestion) {
            srParts.push(decimalFormatter.format(defaultsSafe.price) + '\u00A0‚Ç¨/kg');
          }
          if (hasDensitySuggestion) {
            srParts.push(decimalFormatter.format(defaultsSafe.density) + '\u00A0g/cm¬≥');
          }
          priceSuggestionSrText.textContent = srParts.length ? ' ‚Äì ' + srParts.join(' ¬∑ ') + ' √ºbernehmen' : '';
        }

        var shouldShow = false;
        if (hasPriceSuggestion && pricePerKgInput) {
          var currentPriceRaw = pricePerKgInput.value != null ? pricePerKgInput.value.toString().trim() : '';
          if (!currentPriceRaw) {
            shouldShow = true;
          } else {
            var parsedPrice = parseFloat(currentPriceRaw.replace(',', '.'));
            if (!isFinite(parsedPrice)) {
              shouldShow = true;
            } else if (Math.abs(parsedPrice - defaultsSafe.price) > 0.001) {
              shouldShow = true;
            }
          }
        }

        if (!shouldShow && hasDensitySuggestion && materialDensityInput) {
          var currentDensityRaw = materialDensityInput.value != null ? materialDensityInput.value.toString().trim() : '';
          if (!currentDensityRaw) {
            shouldShow = true;
          } else {
            var parsedDensity = parseFloat(currentDensityRaw.replace(',', '.'));
            if (!isFinite(parsedDensity)) {
              shouldShow = true;
            } else if (Math.abs(parsedDensity - defaultsSafe.density) > 0.001) {
              shouldShow = true;
            }
          }
        }

        if (shouldShow) {
          priceSuggestionButton.classList.remove('is-hidden');
        } else {
          priceSuggestionButton.classList.add('is-hidden');
        }

        updateMaterialDensityResetState(defaultsSafe);
      }

      var materialData = {
        'PLA': {
          price: 20,
          gramsPerMeter: 2.98,
          density: 1.24,
          densityHint: 'Richtwert: 2,98\u00A0g/m ¬∑ 1,24\u00A0g/cm¬≥ (PLA)'
        },
        'PLA_PLUS': {
          price: 23,
          gramsPerMeter: 3.05,
          density: 1.27,
          densityHint: 'Richtwert: 3,05\u00A0g/m ¬∑ 1,27\u00A0g/cm¬≥ (PLA+)'
        },
        'PLA_SILK': {
          price: 25,
          gramsPerMeter: 2.90,
          density: 1.21,
          densityHint: 'Richtwert: 2,90\u00A0g/m ¬∑ 1,21\u00A0g/cm¬≥ (PLA Silk)'
        },
        'PETG': {
          price: 25,
          gramsPerMeter: 3.05,
          density: 1.27,
          densityHint: 'Richtwert: 3,05\u00A0g/m ¬∑ 1,27\u00A0g/cm¬≥ (PETG)'
        },
        'PETG_CF': {
          price: 55,
          gramsPerMeter: 3.20,
          density: 1.33,
          densityHint: 'Richtwert: 3,20\u00A0g/m ¬∑ 1,33\u00A0g/cm¬≥ (PETG-CF)'
        },
        'ABS': {
          price: 27,
          gramsPerMeter: 2.65,
          density: 1.10,
          densityHint: 'Richtwert: 2,65\u00A0g/m ¬∑ 1,10\u00A0g/cm¬≥ (ABS)'
        },
        'ABS_CF': {
          price: 58,
          gramsPerMeter: 2.60,
          density: 1.08,
          densityHint: 'Richtwert: 2,60\u00A0g/m ¬∑ 1,08\u00A0g/cm¬≥ (ABS-CF)'
        },
        'ASA': {
          price: 35,
          gramsPerMeter: 2.57,
          density: 1.07,
          densityHint: 'Richtwert: 2,57\u00A0g/m ¬∑ 1,07\u00A0g/cm¬≥ (ASA)'
        },
        'ASA_CF': {
          price: 60,
          gramsPerMeter: 2.70,
          density: 1.12,
          densityHint: 'Richtwert: 2,70\u00A0g/m ¬∑ 1,12\u00A0g/cm¬≥ (ASA-CF)'
        },
        'TPU': {
          price: 30,
          gramsPerMeter: 2.85,
          density: 1.19,
          densityHint: 'Richtwert: 2,85\u00A0g/m ¬∑ 1,19\u00A0g/cm¬≥ (TPU)'
        },
        'PA': {
          price: 45,
          gramsPerMeter: 2.74,
          density: 1.14,
          densityHint: 'Richtwert: 2,74\u00A0g/m ¬∑ 1,14\u00A0g/cm¬≥ (Nylon)'
        }
      };

      var currentMaterialDefaults = {};
      var pricePerKgUserEdited = false;
      var materialDensityUserEdited = false;
      var machineHourlyUserEdited = false;

      var pricePerKgProgrammatic = false;
      var materialDensityProgrammatic = false;
      var machineHourlyProgrammatic = false;

      var suppressProSync = false;
      var timeSyncInProgress = false;
      var proModeEnabled = false;

      function applyProVisibility(enabled) {
        if (proToggle) {
          proToggle.checked = enabled;
          proToggle.setAttribute('aria-expanded', enabled ? 'true' : 'false');
        }
        if (proFields) {
          proFields.hidden = !enabled;
          proFields.setAttribute('aria-hidden', enabled ? 'false' : 'true');
          if (enabled) {
            proFields.removeAttribute('inert');
          } else {
            proFields.setAttribute('inert', '');
          }
        }
        if (proCard) {
          proCard.hidden = !enabled;
          proCard.setAttribute('aria-hidden', enabled ? 'false' : 'true');
        }
        if (proCardBody) {
          proCardBody.setAttribute('aria-hidden', enabled ? 'false' : 'true');
        }
        if (proRows && proRows.length) {
          proRows.forEach(function (row) {
            row.hidden = !enabled;
          });
        }
        if (proStatusOutput) {
          proStatusOutput.hidden = !enabled;
        }
        if (printProParamsSection) {
          printProParamsSection.hidden = !enabled;
        }
        if (rootElement) {
          rootElement.classList.toggle('is-pro-on', enabled);
          rootElement.classList.toggle('is-pro-off', !enabled);
        }
        if (enabled) {
          syncProCardCollapseForViewport();
        }
      }

      function setProModeEnabled(enabled, options) {
        var normalized = !!enabled;
        proModeEnabled = normalized;
        if (normalized) {
          proCardCollapsed = proCardMediaQuery.matches;
        }
        applyProVisibility(normalized);
        if (!normalized) {
          proCardCollapsed = false;
          updateProCollapseToggle(false);
        }
        if (!options || !options.skipRecalc) {
          recalc();
        }
      }

      function formatPricePlaceholder(value) {
        if (!value || !isFinite(value)) {
          return 'z.\u00A0B. 20';
        }
        var isInteger = Math.abs(value - Math.round(value)) < 0.001;
        var normalized = isInteger ? Math.round(value).toString() : value.toFixed(2);
        return normalized.replace('.', ',');
      }

      function getInputRaw(input) {
        if (!input || input.value == null) {
          return '';
        }
        return input.value.toString().trim();
      }

      function setRowVisibility(row, visible) {
        if (!row) {
          return;
        }
        row.hidden = !visible;
      }

      function normalizeFileNamePart(value) {
        var base = (value || '').toString().trim();
        if (!base) {
          return 'unbenannt';
        }
        var normalized = base;
        if (normalized.normalize) {
          normalized = normalized.normalize('NFKD').replace(/[\u0300-\u036f]/g, '');
        }
        normalized = normalized
          .replace(/√§/gi, 'ae')
          .replace(/√∂/gi, 'oe')
          .replace(/√º/gi, 'ue')
          .replace(/√ü/gi, 'ss');
        normalized = normalized.replace(/[^a-z0-9]+/gi, '_');
        normalized = normalized.replace(/_+/g, '_').replace(/^_+|_+$/g, '');
        return normalized || 'unbenannt';
      }

      function formatDateForFile(date) {
        var year = date.getFullYear();
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var day = String(date.getDate()).padStart(2, '0');
        return year + '-' + month + '-' + day;
      }

      function buildPrintFileName(mode, state) {
        var normalizedPart = normalizeFileNamePart(state.partName);
        var datePart = formatDateForFile(new Date());
        var prefix = mode === 'full' ? 'Kostenblatt_Eingaben' : 'Kostenblatt';
        var nameParts = [prefix];
        if (mode === 'full') {
          nameParts.push(normalizedPart);
        } else {
          nameParts.push(normalizedPart);
        }
        nameParts.push(datePart);
        return nameParts.join('_') + '.pdf';
      }

      function setMaterialDefaults() {
        if (!materialSelect) return;
        var selected = materialSelect.value;
        var defaults = materialData[selected] || {};
        var gramsPerMeter = defaults.gramsPerMeter;
        currentMaterialDefaults = defaults;

        if (weightInput) {
          if (gramsPerMeter) {
            weightInput.dataset.gramsPerMeter = gramsPerMeter.toFixed(2);
          } else {
            delete weightInput.dataset.gramsPerMeter;
          }
        }

        if (lengthInput) {
          if (gramsPerMeter) {
            lengthInput.dataset.gramsPerMeter = gramsPerMeter.toFixed(2);
          } else {
            delete lengthInput.dataset.gramsPerMeter;
          }
        }

        if (materialDensityHint) {
          materialDensityHint.textContent = defaults.densityHint || 'Richtwert: nach Bedarf anpassen';
        }

        if (materialDensityInput) {
          if (defaults.density && isFinite(defaults.density)) {
            materialDensityInput.placeholder = defaults.density.toFixed(2);
          } else {
            materialDensityInput.placeholder = '';
          }
          var shouldApplyDensity = !materialDensityUserEdited || !(materialDensityInput.value || '').toString().trim();
          if (shouldApplyDensity) {
            materialDensityProgrammatic = true;
            if (defaults.density && isFinite(defaults.density)) {
              materialDensityInput.value = defaults.density.toFixed(2);
            } else {
              materialDensityInput.value = '';
            }
            materialDensityProgrammatic = false;
            materialDensityUserEdited = false;
          }
        }

        if (pricePerKgInput) {
          var placeholder = formatPricePlaceholder(defaults.price);
          pricePerKgInput.placeholder = placeholder;
        }

        updateMaterialSuggestionState(defaults);

        triggerRecalc({ immediate: true });
      }

      function parseHours(value) {
        if (!value) return 0;
        if (value instanceof Date) {
          return value.getHours() + value.getMinutes() / 60;
        }
        var parts = value.split(':');
        var hours = parseFloat(parts[0]) || 0;
        var minutes = parseFloat(parts[1]) || 0;
        return hours + minutes / 60;
      }

      function readNumber(input) {
        if (!input) return 0;
        var raw = (input.value || '').toString().replace(',', '.');
        var val = parseFloat(raw);
        if (!isFinite(val) || val < 0) {
          return 0;
        }
        return val;
      }

      function computeGramsPerMeterFromDensity(density) {
        if (!density || density <= 0) {
          return 0;
        }
        var diameterCm = FILAMENT_DIAMETER_MM / 10;
        var radiusCm = diameterCm / 2;
        var crossSection = Math.PI * radiusCm * radiusCm;
        return density * crossSection * 100;
      }

      function setModeFieldState(field, input, isActive) {
        if (!field || !input) {
          return;
        }
        field.hidden = false;
        field.classList.toggle('is-inactive', !isActive);
        field.classList.toggle('is-active', !!isActive);
        if (isActive) {
          input.disabled = false;
          input.removeAttribute('aria-disabled');
        } else {
          input.disabled = true;
          input.setAttribute('aria-disabled', 'true');
        }
      }

      function updateModeVisibility() {
        var useWeight = weightMode.checked;
        setModeFieldState(weightField, weightInput, useWeight);
        setModeFieldState(lengthField, lengthInput, !useWeight);
        triggerRecalc({ immediate: true });
      }

      function formatMinutesDisplay(totalMinutes) {
        var rounded = Math.round(totalMinutes);
        if (!rounded) {
          return '0\u00A0min';
        }
        var hoursPart = Math.floor(rounded / 60);
        var minutesPart = Math.abs(rounded % 60);
        if (hoursPart > 0) {
          if (minutesPart === 0) {
            return hoursPart + '\u00A0h';
          }
          return hoursPart + '\u00A0h ' + minutesPart + '\u00A0min';
        }
        return minutesPart + '\u00A0min';
      }

      function updatePrintTimestamp() {
        if (printTimestampOutput) {
          printTimestampOutput.textContent = dateTimeFormatter.format(new Date());
        }
      }

      function attachRecalcListeners(element, options) {
        if (!element) {
          return;
        }
        var opts = options || {};
        element.addEventListener('input', function (event) {
          if (typeof opts.onInput === 'function') {
            opts.onInput(event);
          }
          triggerRecalc();
        });
        ['change', 'blur'].forEach(function (eventName) {
          element.addEventListener(eventName, function (event) {
            if (eventName === 'change' && typeof opts.onChange === 'function') {
              opts.onChange(event);
            }
            triggerRecalc({ immediate: true });
          });
        });
      }

      function setPrintAttribute(mode) {
        if (!rootElement) return;
        if (mode) {
          rootElement.setAttribute('data-print', mode);
        } else {
          rootElement.removeAttribute('data-print');
        }
      }

      var recalcThrottleDelay = 75;
      function createThrottled(callback, delay) {
        var timeoutId = null;
        var lastCall = 0;
        var safeDelay = typeof delay === 'number' && delay >= 0 ? delay : 0;
        return function () {
          var now = Date.now();
          var remaining = safeDelay - (now - lastCall);
          var invoke = function () {
            timeoutId = null;
            lastCall = Date.now();
            callback();
          };
          if (remaining <= 0) {
            if (timeoutId) {
              clearTimeout(timeoutId);
              timeoutId = null;
            }
            invoke();
          } else if (!timeoutId) {
            timeoutId = setTimeout(invoke, Math.min(remaining, safeDelay));
          }
        };
      }

      var queueRecalc = createThrottled(function () {
        recalc();
      }, recalcThrottleDelay);

      function triggerRecalc(options) {
        if (options && options.immediate) {
          recalc();
        } else {
          queueRecalc();
        }
      }

      function triggerPrint(mode) {
        setPrintAttribute(mode);
        updatePrintTimestamp();
        var state = recalc();
        if (state) {
          var fileTitle = buildPrintFileName(mode, state);
          pendingPrintTitle = fileTitle;
          document.title = fileTitle;
        }
        window.print();
      }

      function hasValue(value) {
        return Math.abs(value) > 0.005;
      }

      function syncProMinutesFromTime(hours) {
        if (!proPrintMinutesInput || suppressProSync || timeSyncInProgress) {
          return;
        }
        if (document.activeElement === proPrintMinutesInput) {
          return;
        }
        timeSyncInProgress = true;
        try {
          var minutes = Math.round(hours * 60);
          if (!minutes) {
            proPrintMinutesInput.value = '';
          } else {
            proPrintMinutesInput.value = minutes.toString();
          }
        } finally {
          timeSyncInProgress = false;
        }
      }

      function updateTimeFromProMinutes() {
        if (!proPrintMinutesInput || !timeInput || timeSyncInProgress) {
          return;
        }
        suppressProSync = true;
        timeSyncInProgress = true;
        try {
          var minutes = Math.max(readNumber(proPrintMinutesInput), 0);
          var hoursPart = Math.floor(minutes / 60);
          var minutesPart = Math.round(minutes % 60);
          var hh = String(hoursPart).padStart(2, '0');
          var mm = String(minutesPart).padStart(2, '0');
          timeInput.value = hh + ':' + mm;
        } finally {
          timeSyncInProgress = false;
          suppressProSync = false;
        }
        recalc();
      }

      function computeState() {
        var partNameRaw = getInputRaw(partNameInput);
        var partNameTrimmed = partNameRaw ? partNameRaw.trim() : '';
        if (partNameTrimmed.length > 80) {
          partNameTrimmed = partNameTrimmed.slice(0, 80);
        }
        var selected = materialSelect.value;
        var defaults = materialData[selected] || {};
        var gramsPerMeter = defaults.gramsPerMeter || 0;

        var pricePerKg = readNumber(pricePerKgInput);
        var proEnabled = proModeEnabled;

        var weightModeActive = !!weightMode.checked;
        var lengthModeActive = !weightModeActive;

        var timeRawValue = getInputRaw(timeInput);
        var powerRawValue = getInputRaw(powerInput);
        var energyPriceRawValue = getInputRaw(energyPriceInput);
        var loadFactorRawValue = getInputRaw(loadFactorInput);
        var wastePercentRawValue = getInputRaw(wastePercentInput);
        var profitMarginRawValue = getInputRaw(profitMarginInput);
        var hourlyRateRawValue = getInputRaw(hourlyRateInput);
        var setupMinutesRawValue = getInputRaw(setupMinutesInput);
        var proMinutesRawValue = getInputRaw(proPrintMinutesInput);
        var finishingMinutesRawValue = getInputRaw(finishingMinutesInput);
        var fixedCostRawValue = getInputRaw(fixedCostInput);
        var discountPercentRawValue = getInputRaw(discountPercentInput);
        var errorRateRawValue = getInputRaw(errorRateInput);
        var packagingCostRawValue = getInputRaw(packagingCostInput);
        var shippingCostRawValue = getInputRaw(shippingCostInput);
        var machineHourlyRawValue = getInputRaw(machineHourlyInput);
        var machinePurchaseRawValue = getInputRaw(machinePurchaseInput);
        var machineLifetimeRawValue = getInputRaw(machineLifetimeInput);
        var materialDensityRawValue = getInputRaw(materialDensityInput);

        var materialDensityValue = readNumber(materialDensityInput);
        var weightInputValue = weightModeActive ? readNumber(weightInput) : 0;
        var lengthInputValue = lengthModeActive ? readNumber(lengthInput) : 0;

        var weight = weightInputValue;
        var length = lengthInputValue;

        if (weightModeActive) {
          if (gramsPerMeter > 0 && weight > 0) {
            length = weight / gramsPerMeter;
          } else {
            length = 0;
          }
        } else {
          var gramsPerMeterFromDensity = proEnabled && materialDensityValue > 0
            ? computeGramsPerMeterFromDensity(materialDensityValue)
            : 0;
          var effectiveGramsPerMeter = gramsPerMeterFromDensity > 0 ? gramsPerMeterFromDensity : gramsPerMeter;
          if (effectiveGramsPerMeter > 0 && length > 0) {
            weight = length * effectiveGramsPerMeter;
          } else {
            weight = 0;
          }
        }

        if (!isFinite(weight) || weight < 0) {
          weight = 0;
        }
        if (!isFinite(length) || length < 0) {
          length = 0;
        }

        var hours = parseHours(timeInput.value || '0:00');
        var power = readNumber(powerInput);
        var energyPrice = readNumber(energyPriceInput);
        var loadFactorRaw = loadFactorRawValue;
        var loadFactorValue = readNumber(loadFactorInput);
        var loadFactor = Math.min(Math.max(loadFactorValue, 0), 100);
        if (!loadFactorRaw) {
          loadFactorInput.value = '';
        } else {
          var parsedLoadFactor = parseFloat(loadFactorRaw.replace(',', '.'));
          if (!isFinite(parsedLoadFactor)) {
            loadFactorInput.value = '';
          } else if (Math.abs(parsedLoadFactor - loadFactor) > 0.0001) {
            loadFactorInput.value = loadFactor.toString();
          }
        }

        syncProMinutesFromTime(hours);

        var materialCost = (weight / 1000) * pricePerKg;
        var wastePercent = wastePercentInput ? readNumber(wastePercentInput) : 0;
        if (wastePercentInput && wastePercent > 100) {
          wastePercent = 100;
          wastePercentInput.value = wastePercent.toString();
        } else if (!wastePercentRawValue && wastePercentInput) {
          wastePercent = 0;
          wastePercentInput.value = '';
        }

        var materialWaste = materialCost * (wastePercent / 100);
        var materialWithWaste = materialCost + materialWaste;
        var materialErrorValue = 0;
        var materialTotal = materialWithWaste;

        var errorRate = readNumber(errorRateInput);
        if (errorRateInput) {
          if (errorRate > 100) {
            errorRate = 100;
            errorRateInput.value = errorRate.toString();
          } else if (!errorRateRawValue) {
            errorRate = 0;
            errorRateInput.value = '';
          }
        }

        if (proEnabled && errorRate > 0) {
          materialErrorValue = materialWithWaste * (errorRate / 100);
          materialTotal = materialWithWaste + materialErrorValue;
        }
        var loadFactorShare = loadFactor / 100;
        var energyCost = (power / 1000) * hours * energyPrice * loadFactorShare;
        var co2EmissionKg = (power / 1000) * hours * loadFactorShare * 0.4;
        var co2EmissionGrams = co2EmissionKg * 1000;
        var showCo2 = power > 0 && hours > 0 && loadFactor > 0;
        var vatIncluded = !!vatCheckbox.checked;
        var machinePurchase = readNumber(machinePurchaseInput);
        var machineLifetime = readNumber(machineLifetimeInput);
        var machineHourlyManual = readNumber(machineHourlyInput);
        var packagingCost = readNumber(packagingCostInput);
        var shippingCost = readNumber(shippingCostInput);
        if (packagingCostInput && !packagingCostRawValue) {
          packagingCost = 0;
          packagingCostInput.value = '';
        }
        if (shippingCostInput && !shippingCostRawValue) {
          shippingCost = 0;
          shippingCostInput.value = '';
        }
        if (machineHourlyInput && !machineHourlyRawValue) {
          machineHourlyManual = 0;
          machineHourlyInput.value = '';
          machineHourlyUserEdited = false;
        }
        if (machinePurchaseInput && !machinePurchaseRawValue) {
          machinePurchase = 0;
          machinePurchaseInput.value = '';
        }
        if (machineLifetimeInput && !machineLifetimeRawValue) {
          machineLifetime = 0;
          machineLifetimeInput.value = '';
        }
        var hasDensityValue = !!materialDensityRawValue;
        if (materialDensityInput && !hasDensityValue) {
          materialDensityValue = 0;
        }
        var machineAutoRate = 0;
        if (machinePurchase > 0 && machineLifetime > 0) {
          machineAutoRate = machinePurchase / machineLifetime;
        }
        if (machineAutoRate > 0 && machineHourlyInput) {
          var machineHourlyCurrentRaw = machineHourlyInput.value != null ? machineHourlyInput.value.toString().trim() : '';
          var hasCurrentHourly = machineHourlyCurrentRaw.length > 0;
          if (!machineHourlyUserEdited || !hasCurrentHourly) {
            machineHourlyProgrammatic = true;
            machineHourlyInput.value = machineAutoRate.toFixed(2);
            machineHourlyProgrammatic = false;
            machineHourlyUserEdited = false;
            machineHourlyManual = machineAutoRate;
          }
        }
        if (machineAutoHint) {
          if (machineAutoRate > 0) {
            machineAutoHint.textContent = 'Aus Eingaben: ' + formatter.format(machineAutoRate) + ' pro Stunde.';
          } else if (machinePurchaseRawValue || machineLifetimeRawValue) {
            machineAutoHint.textContent = 'Bitte Anschaffung & Lebensdauer komplett eintragen.';
          } else {
            machineAutoHint.textContent = 'Ergibt automatisch einen ‚Ç¨/h-Wert.';
          }
        }
        var labourMinutes = 0;
        var timeCost = 0;
        var fixedCostValue = 0;
        var standardSubtotal = materialWithWaste + energyCost;
        var marginBase = standardSubtotal;
        var marginValue = 0;
        var discountPercentValue = 0;
        var discountValue = 0;
        var netBeforeDiscount = marginBase;
        var net = marginBase;
        var gross = vatIncluded ? net * 1.19 : net;

        var defaultMinutes = Math.round(hours * 60);
        var profitMargin = 0;
        var hourlyRate = 0;
        var setupMinutes = 0;
        var proMinutes = 0;
        var finishingMinutes = 0;
        var fixedCost = 0;
        var discountPercent = 0;
        var machineHourlyEffective = 0;
        var machineCost = 0;
        var packagingValue = 0;
        var shippingValue = 0;
        var proData = {
          enabled: proEnabled,
          profitMargin: 0,
          hourlyRate: 0,
          setupMinutes: 0,
          printMinutes: defaultMinutes,
          finishingMinutes: 0,
          wastePercent: wastePercent,
          materialWaste: materialWaste,
          materialErrorPercent: proEnabled ? errorRate : 0,
          materialErrorValue: proEnabled ? materialErrorValue : 0,
          materialWithWaste: materialWithWaste,
          materialTotal: proEnabled ? materialTotal : materialWithWaste,
          labourMinutes: labourMinutes,
          timeCost: timeCost,
          fixedCost: fixedCostValue,
          fixedCostBase: proEnabled ? fixedCost : 0,
          packagingCost: 0,
          shippingCost: 0,
          machineHourly: 0,
          machineAutoHourly: machineAutoRate,
          machineCost: 0,
          machinePurchase: proEnabled ? machinePurchase : 0,
          machineLifetime: proEnabled ? machineLifetime : 0,
          marginBase: marginBase,
          subtotal: marginBase,
          marginValue: marginValue,
          discountPercent: discountPercentValue,
          discountValue: discountValue,
          netBeforeDiscount: netBeforeDiscount,
          net: net,
          gross: gross,
          standardSubtotal: standardSubtotal,
          materialDensity: proEnabled ? materialDensityValue : 0
        };

        if (proEnabled) {
          profitMargin = readNumber(profitMarginInput);
          if (profitMargin > 100) {
            profitMargin = 100;
            profitMarginInput.value = profitMargin.toString();
          }
          hourlyRate = readNumber(hourlyRateInput);
          setupMinutes = readNumber(setupMinutesInput);
          proMinutes = readNumber(proPrintMinutesInput);
          if (!proMinutes && defaultMinutes) {
            proMinutes = defaultMinutes;
            proPrintMinutesInput.value = proMinutes.toString();
          }
          finishingMinutes = readNumber(finishingMinutesInput);
          fixedCost = readNumber(fixedCostInput);
          discountPercent = readNumber(discountPercentInput);
          if (discountPercent > 100) {
            discountPercent = 100;
            discountPercentInput.value = discountPercent.toString();
          }
          packagingValue = packagingCost;
          shippingValue = shippingCost;
          machineHourlyEffective = machineHourlyManual > 0 ? machineHourlyManual : machineAutoRate;
          standardSubtotal = materialWithWaste + energyCost;
          var subtotalWithMaterial = materialTotal + energyCost;
          labourMinutes = setupMinutes + finishingMinutes;
          timeCost = (hourlyRate / 60) * labourMinutes;
          machineCost = hours * machineHourlyEffective;
          marginBase = subtotalWithMaterial + timeCost + machineCost;
          fixedCostValue = fixedCost + packagingValue + shippingValue;
          marginValue = marginBase * (profitMargin / 100);
          netBeforeDiscount = marginBase + marginValue + fixedCostValue;
          discountPercentValue = discountPercent;
          discountValue = netBeforeDiscount * (discountPercent / 100);
          var proNet = netBeforeDiscount - discountValue;
          var proGross = vatIncluded ? proNet * 1.19 : proNet;

          net = proNet;
          gross = proGross;

          proData = {
            enabled: true,
            profitMargin: profitMargin,
            hourlyRate: hourlyRate,
            setupMinutes: setupMinutes,
            printMinutes: proMinutes,
            finishingMinutes: finishingMinutes,
            wastePercent: wastePercent,
            materialWaste: materialWaste,
            materialErrorPercent: errorRate,
            materialErrorValue: materialErrorValue,
            materialWithWaste: materialWithWaste,
            materialTotal: materialTotal,
            labourMinutes: labourMinutes,
            timeCost: timeCost,
            fixedCost: fixedCostValue,
            fixedCostBase: fixedCost,
            packagingCost: packagingValue,
            shippingCost: shippingValue,
            machineHourly: machineHourlyEffective,
            machineAutoHourly: machineAutoRate,
            machineCost: machineCost,
            marginBase: marginBase,
            subtotal: marginBase,
            marginValue: marginValue,
            discountPercent: discountPercentValue,
            discountValue: discountValue,
            netBeforeDiscount: netBeforeDiscount,
            net: proNet,
            gross: proGross,
            standardSubtotal: standardSubtotal,
            materialDensity: materialDensityValue,
            machinePurchase: machinePurchase,
            machineLifetime: machineLifetime
          };
        }

        var chartEnabled = !resultChartToggle || !!resultChartToggle.checked;

        var materialLabel = materialSelect.options[materialSelect.selectedIndex]
          ? materialSelect.options[materialSelect.selectedIndex].textContent
          : selected;

        var inputVisibility = {
          weight: weightMode.checked && weight > 0,
          length: !weightMode.checked && length > 0,
          duration: hours > 0,
          power: power > 0,
          energyPrice: energyPrice > 0,
          loadFactor: !!loadFactorRawValue,
          wastePercent: !!wastePercentRawValue && wastePercent > 0,
          profitMargin: proEnabled && profitMargin > 0,
          hourlyRate: proEnabled && hourlyRate > 0,
          setupMinutes: proEnabled && setupMinutes > 0,
          printMinutes: proEnabled && proMinutes > 0,
          finishingMinutes: proEnabled && finishingMinutes > 0,
          fixedCost: proEnabled && fixedCost > 0,
          discountPercent: proEnabled && discountPercent > 0,
          errorRate: proEnabled && errorRate > 0,
          packagingCost: proEnabled && packagingValue > 0,
          shippingCost: proEnabled && shippingValue > 0,
          machineHourlyRate: proEnabled && machineHourlyEffective > 0,
          machinePurchase: proEnabled && machinePurchase > 0,
          machineLifetime: proEnabled && machineLifetime > 0,
          materialDensity: proEnabled && materialDensityValue > 0
        };

        return {
          materialLabel: materialLabel,
          pricePerKg: pricePerKg,
          modeLabel: weightMode.checked ? 'Bauteilgewicht' : 'Filamentl√§nge',
          weight: weight,
          length: length,
          hours: hours,
          power: power,
          energyPrice: energyPrice,
          loadFactor: loadFactor,
          co2EmissionGrams: co2EmissionGrams,
          showCo2: showCo2,
          vatIncluded: vatIncluded,
          materialCost: materialCost,
          energyCost: energyCost,
          net: net,
          gross: gross,
          standardSubtotal: standardSubtotal,
          pro: proData,
          partName: partNameTrimmed,
          hasPartName: partNameTrimmed.length > 0,
          chartEnabled: chartEnabled,
          mode: weightMode.checked ? 'weight' : 'length',
          inputs: inputVisibility
        };
      }

      function updateResults(state) {
        materialCostOutput.textContent = formatter.format(state.materialCost);
        energyCostOutput.textContent = formatter.format(state.energyCost);
        if (co2Output && co2ValueOutput) {
          if (state.showCo2) {
            co2Output.hidden = false;
            co2Output.setAttribute('aria-hidden', 'false');
            co2ValueOutput.textContent = co2Formatter.format(state.co2EmissionGrams) + '\u00A0g';
          } else {
            co2Output.hidden = true;
            co2Output.setAttribute('aria-hidden', 'true');
          }
        }
        totalNetOutput.textContent = formatter.format(state.net);
        totalGrossOutput.textContent = formatter.format(state.gross);

        if (grossLabelOutput) {
          grossLabelOutput.textContent = state.vatIncluded ? 'Gesamtkosten (brutto)' : 'Gesamtkosten (brutto, ¬ß19 UStG)';
        }

        var weightText = integerFormatter.format(state.weight) + '\u00A0g';
        var lengthText = decimalFormatter.format(state.length) + '\u00A0m';
        var metaText = 'Gewicht: ' + weightText + ' ¬∑ L√§nge: ' + lengthText;
        if (state.pro.enabled) {
          metaText += ' ¬∑ Pro-Optionen aktiv';
        }
        metaOutput.textContent = metaText;

        materialCostLabelOutput.textContent = 'Material (Basis)';
        if (energyCostLabelOutput) {
          energyCostLabelOutput.textContent = 'Energiekosten';
        }

        if (materialWasteOutput) {
          materialWasteOutput.textContent = formatter.format(state.pro.materialWaste);
        }
        if (materialWasteRow) {
          materialWasteRow.hidden = false;
        }

        if (materialTotalOutput) {
          materialTotalOutput.textContent = formatter.format(state.pro.materialTotal);
        }
        if (materialTotalRow) {
          materialTotalRow.hidden = false;
        }

        if (timeCostOutput) {
          timeCostOutput.textContent = formatter.format(state.pro.timeCost);
        }

        if (machineCostOutput) {
          machineCostOutput.textContent = formatter.format(state.pro.machineCost);
        }

        if (fixedCostOutput) {
          fixedCostOutput.textContent = formatter.format(state.pro.fixedCost);
        }

        if (subtotalOutput) {
          var subtotalValue = state.pro.enabled ? state.pro.subtotal : state.standardSubtotal;
          subtotalOutput.textContent = formatter.format(subtotalValue);
        }

        if (marginOutput) {
          marginOutput.textContent = formatter.format(state.pro.marginValue);
        }

        if (discountOutput) {
          var discountText = hasValue(state.pro.discountValue)
            ? '‚Äì ' + formatter.format(state.pro.discountValue)
            : formatter.format(state.pro.discountValue);
          discountOutput.textContent = discountText;
        }

        renderResultChart(state);
      }

      function getCostChartData(state) {
        var items = [];
        if (state.pro.materialTotal > 0) {
          items.push({ key: 'material', label: 'Material', value: state.pro.materialTotal });
        }
        if (state.energyCost > 0) {
          items.push({ key: 'energy', label: 'Energie', value: state.energyCost });
        }
        if (state.pro.timeCost > 0) {
          items.push({ key: 'labor', label: 'Arbeitszeit', value: state.pro.timeCost });
        }
        if (state.pro.machineCost > 0) {
          items.push({ key: 'machine', label: 'Maschine', value: state.pro.machineCost });
        }
        if (state.pro.fixedCost > 0) {
          items.push({ key: 'fix', label: 'Fixkosten', value: state.pro.fixedCost });
        }
        if (state.pro.marginValue > 0) {
          items.push({ key: 'margin', label: 'Marge', value: state.pro.marginValue });
        }

        var discountValue = state.pro.discountValue > 0 ? state.pro.discountValue : 0;
        var positiveTotal = items.reduce(function (sum, item) { return sum + item.value; }, 0);
        return {
          items: items,
          discountValue: discountValue,
          positiveTotal: positiveTotal,
          hasData: items.length > 0 || discountValue > 0
        };
      }

      function renderCostBars(container, data, options) {
        if (!container) {
          return;
        }
        while (container.firstChild) {
          container.removeChild(container.firstChild);
        }

        var safeTotal = data.positiveTotal > 0 ? data.positiveTotal : 1;
        var barClass = options && options.barClass ? options.barClass : 'result-bar';
        var labelClass = options && options.labelClass ? options.labelClass : 'result-bar__label';
        var trackClass = options && options.trackClass ? options.trackClass : 'result-bar__track';
        var fillClass = options && options.fillClass ? options.fillClass : 'result-bar__fill';
        var discountClass = options && options.discountClass ? options.discountClass : barClass + '--discount';

        data.items.forEach(function (item) {
          var share = item.value / safeTotal;
          var width = share > 0 ? Math.max(Math.min(share * 100, 100), 3) : 0;
          var bar = document.createElement('div');
          bar.className = barClass + ' ' + barClass + '--' + item.key;
          bar.setAttribute('role', 'listitem');

          var percentText = safeTotal > 0 ? chartCompactPercentFormatter.format(share * 100) + '\u00A0%' : '0\u00A0%';
          var label = document.createElement('span');
          label.className = labelClass;
          label.textContent = item.label + ': ' + formatter.format(item.value) + ' (' + percentText + ')';

          var track = document.createElement('div');
          track.className = trackClass;
          var fill = document.createElement('span');
          fill.className = fillClass;
          fill.setAttribute('aria-hidden', 'true');
          fill.style.width = width + '%';

          var ariaPercentText = safeTotal > 0 ? chartCompactPercentFormatter.format(share * 100) + ' %' : '0 %';
          bar.setAttribute('aria-label', item.label + ': ' + formatter.format(item.value) + ' (' + ariaPercentText + ')');

          track.appendChild(fill);
          bar.appendChild(label);
          bar.appendChild(track);
          container.appendChild(bar);
        });

        if (data.discountValue > 0) {
          var discountShare = data.discountValue / safeTotal;
          var discountWidth = discountShare > 0 ? Math.max(Math.min(discountShare * 100, 100), 3) : 0;
          var discountBar = document.createElement('div');
          discountBar.className = barClass + ' ' + discountClass;
          discountBar.setAttribute('role', 'listitem');

          var discountPercentText = safeTotal > 0 ? chartCompactPercentFormatter.format(discountShare * 100) + '\u00A0%' : '0\u00A0%';
          var discountLabel = document.createElement('span');
          discountLabel.className = labelClass;
          discountLabel.textContent = 'Rabatt: ‚Äì ' + formatter.format(data.discountValue) + ' (' + discountPercentText + ')';

          var discountTrack = document.createElement('div');
          discountTrack.className = trackClass;
          var discountFill = document.createElement('span');
          discountFill.className = fillClass;
          discountFill.setAttribute('aria-hidden', 'true');
          discountFill.style.width = discountWidth + '%';

          var discountAriaPercent = safeTotal > 0 ? chartCompactPercentFormatter.format(discountShare * 100) + ' %' : '0 %';
          discountBar.setAttribute('aria-label', 'Rabatt: ‚Äì ' + formatter.format(data.discountValue) + ' (' + discountAriaPercent + ')');

          discountTrack.appendChild(discountFill);
          discountBar.appendChild(discountLabel);
          discountBar.appendChild(discountTrack);
          container.appendChild(discountBar);
        }
      }

      function renderResultChart(state) {
        if (!resultChartSection || !resultChartBars) {
          return;
        }

        var data = getCostChartData(state);

        if (!data.hasData) {
          resultChartSection.hidden = true;
          resultChartSection.setAttribute('aria-hidden', 'true');
          return;
        }

        resultChartSection.hidden = false;
        if (resultChartToggle) {
          setChartVisibility(resultChartToggle.checked);
        } else {
          resultChartSection.classList.remove('is-collapsed');
          resultChartSection.setAttribute('aria-hidden', 'false');
        }

        if (chartNetTotalOutput) {
          chartNetTotalOutput.textContent = 'Gesamtkosten (netto): ' + formatter.format(state.net);
        }

        renderCostBars(resultChartBars, data, {
          barClass: 'result-bar',
          labelClass: 'result-bar__label',
          trackClass: 'result-bar__track',
          fillClass: 'result-bar__fill',
          discountClass: 'result-bar--discount'
        });
      }

      function updatePrintSummary(state) {
        if (!printMaterialOutput) {
          return;
        }

        if (printHeaderPartName) {
          if (state.hasPartName) {
            printHeaderPartName.hidden = false;
            if (printHeaderPartNameValue) {
              printHeaderPartNameValue.textContent = state.partName;
            }
          } else {
            printHeaderPartName.hidden = true;
            if (printHeaderPartNameValue) {
              printHeaderPartNameValue.textContent = '';
            }
          }
        }

        if (printInputsPartName) {
          if (state.hasPartName) {
            printInputsPartName.hidden = false;
            if (printInputsPartNameValue) {
              printInputsPartNameValue.textContent = state.partName;
            }
          } else {
            printInputsPartName.hidden = true;
            if (printInputsPartNameValue) {
              printInputsPartNameValue.textContent = '';
            }
          }
        }

        printMaterialOutput.textContent = state.materialLabel;
        printMaterialPriceOutput.textContent = decimalFormatter.format(state.pricePerKg) + '\u00A0‚Ç¨/kg';
        printModeOutput.textContent = state.modeLabel;

        printWeightOutput.textContent = integerFormatter.format(state.weight) + '\u00A0g';
        printLengthOutput.textContent = decimalFormatter.format(state.length) + '\u00A0m';
        printTimeOutput.textContent = formatMinutesDisplay(state.hours * 60);
        printPowerOutput.textContent = integerFormatter.format(state.power) + '\u00A0W';
        printEnergyPriceOutput.textContent = decimalFormatter.format(state.energyPrice) + '\u00A0‚Ç¨/kWh';
        printLoadFactorOutput.textContent = integerFormatter.format(state.loadFactor) + '\u00A0%';
        printWastePercentOutput.textContent = percentNumberFormatter.format(state.pro.wastePercent) + '\u00A0%';

        setRowVisibility(printInputRows.weight, !!state.inputs.weight);
        setRowVisibility(printInputRows.length, !!state.inputs.length);
        setRowVisibility(printInputRows.duration, !!state.inputs.duration);
        setRowVisibility(printInputRows.power, !!state.inputs.power);
        setRowVisibility(printInputRows.energyPrice, !!state.inputs.energyPrice);
        setRowVisibility(printInputRows.loadFactor, !!state.inputs.loadFactor);
        setRowVisibility(printInputRows.wastePercent, !!state.inputs.wastePercent);

        if (printMaterialTotalOutput) {
          printMaterialTotalOutput.textContent = formatter.format(state.pro.materialTotal);
        }
        if (printEnergyCostOutput) {
          printEnergyCostOutput.textContent = formatter.format(state.energyCost);
        }
        if (printTimeCostOutput) {
          printTimeCostOutput.textContent = formatter.format(state.pro.timeCost);
        }
        if (printMachineCostOutput) {
          printMachineCostOutput.textContent = formatter.format(state.pro.machineCost);
        }
        if (printFixedCostOutput) {
          printFixedCostOutput.textContent = formatter.format(state.pro.fixedCost);
        }
        if (printPackagingCostOutput) {
          printPackagingCostOutput.textContent = formatter.format(state.pro.packagingCost);
        }
        if (printShippingCostOutput) {
          printShippingCostOutput.textContent = formatter.format(state.pro.shippingCost);
        }
        if (printMachineHourlyOutput) {
          printMachineHourlyOutput.textContent = formatter.format(state.pro.machineHourly) + '/h';
        }
        if (printMachinePurchaseOutput) {
          printMachinePurchaseOutput.textContent = formatter.format(state.pro.machinePurchase);
        }
        if (printMachineLifetimeOutput) {
          printMachineLifetimeOutput.textContent = integerFormatter.format(state.pro.machineLifetime) + '\u00A0h';
        }
        if (printMaterialDensityOutput) {
          printMaterialDensityOutput.textContent = decimalFormatter.format(state.pro.materialDensity) + '\u00A0g/cm¬≥';
        }
        if (printErrorRateOutput) {
          printErrorRateOutput.textContent = percentNumberFormatter.format(state.pro.materialErrorPercent) + '\u00A0%';
        }
        if (printSubtotalOutput) {
          var subtotalValue = state.pro.enabled ? state.pro.subtotal : state.standardSubtotal;
          printSubtotalOutput.textContent = formatter.format(subtotalValue);
        }
        if (printMarginOutput) {
          printMarginOutput.textContent = formatter.format(state.pro.marginValue);
        }
        if (printDiscountOutput) {
          var discountText = hasValue(state.pro.discountValue)
            ? '‚Äì ' + formatter.format(state.pro.discountValue)
            : formatter.format(state.pro.discountValue);
          printDiscountOutput.textContent = discountText;
        }

        setRowVisibility(printSummaryItemTime, state.pro.enabled && hasValue(state.pro.timeCost));
        setRowVisibility(printSummaryItemMachine, state.pro.enabled && hasValue(state.pro.machineCost));
        setRowVisibility(printSummaryItemFixed, state.pro.enabled && hasValue(state.pro.fixedCost));
        setRowVisibility(printSummaryItemMargin, state.pro.enabled && hasValue(state.pro.marginValue));
        setRowVisibility(printSummaryItemDiscount, state.pro.enabled && hasValue(state.pro.discountValue));

        printNetOutput.textContent = formatter.format(state.net);
        printGrossOutput.textContent = formatter.format(state.gross);

        var highlightValue = state.vatIncluded ? state.gross : state.net;
        printTotalOutput.textContent = formatter.format(highlightValue);

        if (printTotalContextOutput) {
          printTotalContextOutput.textContent = state.vatIncluded ? ' (inkl. MwSt.)' : ' (netto)';
        }

        if (state.vatIncluded) {
          printVatNoteOutput.textContent = 'Preise inkl. MwSt. (19\u00A0%)';
        } else {
          printVatNoteOutput.textContent = 'Hinweis: ¬ß19 UStG ‚Äì keine Umsatzsteuer.';
        }

        if (printProParamsSection) {
          var proVisibility = {
            profitMargin: state.inputs.profitMargin,
            hourlyRate: state.inputs.hourlyRate,
            setupMinutes: state.inputs.setupMinutes,
            printMinutes: state.inputs.printMinutes,
            finishingMinutes: state.inputs.finishingMinutes,
            fixedCost: state.inputs.fixedCost,
            discountPercent: state.inputs.discountPercent,
            errorRate: state.inputs.errorRate,
            packagingCost: state.inputs.packagingCost,
            shippingCost: state.inputs.shippingCost,
            machineHourlyRate: state.inputs.machineHourlyRate,
            machinePurchase: state.inputs.machinePurchase,
            machineLifetime: state.inputs.machineLifetime,
            materialDensity: state.inputs.materialDensity
          };

          if (state.pro.enabled) {
            printProfitMarginOutput.textContent = percentNumberFormatter.format(state.pro.profitMargin) + '\u00A0%';
            printHourlyRateOutput.textContent = formatter.format(state.pro.hourlyRate) + '/h';
            printSetupMinutesOutput.textContent = integerFormatter.format(state.pro.setupMinutes) + '\u00A0min';
            printProPrintMinutesOutput.textContent = integerFormatter.format(state.pro.printMinutes) + '\u00A0min';
            printFinishingMinutesOutput.textContent = integerFormatter.format(state.pro.finishingMinutes) + '\u00A0min';
            printFixedCostInputOutput.textContent = formatter.format(state.pro.fixedCostBase);
            printDiscountPercentOutput.textContent = percentNumberFormatter.format(state.pro.discountPercent) + '\u00A0%';
            if (printErrorRateOutput) {
              printErrorRateOutput.textContent = percentNumberFormatter.format(state.pro.materialErrorPercent) + '\u00A0%';
            }
            if (printPackagingCostOutput) {
              printPackagingCostOutput.textContent = formatter.format(state.pro.packagingCost);
            }
            if (printShippingCostOutput) {
              printShippingCostOutput.textContent = formatter.format(state.pro.shippingCost);
            }
            if (printMachineHourlyOutput) {
              printMachineHourlyOutput.textContent = formatter.format(state.pro.machineHourly) + '/h';
            }
            if (printMachinePurchaseOutput) {
              printMachinePurchaseOutput.textContent = formatter.format(state.pro.machinePurchase);
            }
            if (printMachineLifetimeOutput) {
              printMachineLifetimeOutput.textContent = integerFormatter.format(state.pro.machineLifetime) + '\u00A0h';
            }
            if (printMaterialDensityOutput) {
              printMaterialDensityOutput.textContent = decimalFormatter.format(state.pro.materialDensity) + '\u00A0g/cm¬≥';
            }

            setRowVisibility(printProInputRows.profitMargin, !!proVisibility.profitMargin);
            setRowVisibility(printProInputRows.hourlyRate, !!proVisibility.hourlyRate);
            setRowVisibility(printProInputRows.setupMinutes, !!proVisibility.setupMinutes);
            setRowVisibility(printProInputRows.printMinutes, !!proVisibility.printMinutes);
            setRowVisibility(printProInputRows.finishingMinutes, !!proVisibility.finishingMinutes);
            setRowVisibility(printProInputRows.fixedCost, !!proVisibility.fixedCost);
            setRowVisibility(printProInputRows.discountPercent, !!proVisibility.discountPercent);
            setRowVisibility(printProInputRows.errorRate, !!proVisibility.errorRate);
            setRowVisibility(printProInputRows.packagingCost, !!proVisibility.packagingCost);
            setRowVisibility(printProInputRows.shippingCost, !!proVisibility.shippingCost);
            setRowVisibility(printProInputRows.machineHourlyRate, !!proVisibility.machineHourlyRate);
            setRowVisibility(printProInputRows.machinePurchase, !!proVisibility.machinePurchase);
            setRowVisibility(printProInputRows.machineLifetime, !!proVisibility.machineLifetime);
            setRowVisibility(printProInputRows.materialDensity, !!proVisibility.materialDensity);

            var hasVisibleProRow = Object.keys(proVisibility).some(function (key) {
              return !!proVisibility[key];
            });
            printProParamsSection.hidden = !hasVisibleProRow;
          } else {
            printProParamsSection.hidden = true;
          }
        }

        var chartData = getCostChartData(state);
        var shouldShowChart = state.chartEnabled && chartData.hasData;
        if (printResultGrid) {
          if (shouldShowChart) {
            printResultGrid.classList.remove('calc-print__result-grid--single');
          } else {
            printResultGrid.classList.add('calc-print__result-grid--single');
          }
        }

        if (printChartSection && printChartBarsOutput) {
          if (!shouldShowChart) {
            printChartSection.hidden = true;
            printChartSection.setAttribute('aria-hidden', 'true');
            if (printChartNoteOutput) {
              printChartNoteOutput.textContent = '';
            }
          } else {
            printChartSection.hidden = false;
            printChartSection.setAttribute('aria-hidden', 'false');
            renderCostBars(printChartBarsOutput, chartData, {
              barClass: 'calc-print__bar',
              labelClass: 'calc-print__bar-label',
              trackClass: 'calc-print__bar-track',
              fillClass: 'calc-print__bar-fill',
              discountClass: 'calc-print__bar--discount'
            });
            if (printChartNoteOutput) {
              printChartNoteOutput.textContent = 'Gesamtkosten (netto): ' + formatter.format(state.net);
            }
          }
        }
      }

      function recalc() {
        var state = computeState();
        updateResults(state);
        updatePrintSummary(state);
        return state;
      }

      materialSelect.addEventListener('change', setMaterialDefaults);
      weightMode.addEventListener('change', updateModeVisibility);
      lengthMode.addEventListener('change', updateModeVisibility);

      attachRecalcListeners(pricePerKgInput, {
        onInput: function () {
          if (!pricePerKgProgrammatic) {
            var valueRaw = pricePerKgInput.value != null ? pricePerKgInput.value.toString().trim() : '';
            pricePerKgUserEdited = valueRaw.length > 0;
          }
          var currentDefaults = materialSelect ? materialData[materialSelect.value] || {} : {};
          updateMaterialSuggestionState(currentDefaults);
        },
        onChange: function () {
          if (!pricePerKgProgrammatic) {
            var valueRaw = pricePerKgInput.value != null ? pricePerKgInput.value.toString().trim() : '';
            pricePerKgUserEdited = valueRaw.length > 0;
          }
          var currentDefaults = materialSelect ? materialData[materialSelect.value] || {} : {};
          updateMaterialSuggestionState(currentDefaults);
        }
      });

      [weightInput, lengthInput, powerInput, energyPriceInput, loadFactorInput, wastePercentInput, partNameInput].forEach(function (input) {
        attachRecalcListeners(input);
      });

      attachRecalcListeners(timeInput);

      if (vatCheckbox) {
        vatCheckbox.addEventListener('input', function () {
          triggerRecalc({ immediate: true });
        });
        vatCheckbox.addEventListener('change', function () {
          triggerRecalc({ immediate: true });
        });
      }

      if (priceSuggestionButton) {
        priceSuggestionButton.addEventListener('click', function () {
          if (!materialSelect || !pricePerKgInput) {
            return;
          }

          var defaults = materialData[materialSelect.value] || {};
          var hasPrice = typeof defaults.price === 'number' && isFinite(defaults.price);
          var hasDensity = typeof defaults.density === 'number' && isFinite(defaults.density);
          if (!hasPrice && !hasDensity) {
            return;
          }

          if (hasPrice) {
            pricePerKgProgrammatic = true;
            pricePerKgInput.value = defaults.price.toString();
            pricePerKgProgrammatic = false;
            pricePerKgUserEdited = false;
          }

          if (hasDensity && materialDensityInput) {
            materialDensityProgrammatic = true;
            materialDensityInput.value = defaults.density.toFixed(2);
            materialDensityProgrammatic = false;
            materialDensityUserEdited = false;
          }

          updateMaterialSuggestionState(defaults);
          triggerRecalc({ immediate: true });

          pricePerKgInput.focus();
        });
      }

      if (materialDensityResetButton && materialDensityInput) {
        materialDensityResetButton.addEventListener('click', function () {
          var defaults = currentMaterialDefaults || {};
          var hasDensity = typeof defaults.density === 'number' && isFinite(defaults.density);
          materialDensityProgrammatic = true;
          if (hasDensity) {
            materialDensityInput.value = defaults.density.toFixed(2);
          } else {
            materialDensityInput.value = '';
          }
          materialDensityProgrammatic = false;
          materialDensityUserEdited = false;
          updateMaterialSuggestionState(defaults);
          triggerRecalc({ immediate: true });
          if (proModeEnabled && !materialDensityInput.disabled) {
            materialDensityInput.focus();
          }
        });
      }

      if (printResultButton) {
        printResultButton.addEventListener('click', function () {
          triggerPrint('result');
        });
      }

      if (printFullButton) {
        printFullButton.addEventListener('click', function () {
          triggerPrint('full');
        });
      }

      setProModeEnabled(false, { skipRecalc: true });

      if (proToggle) {
        proToggle.addEventListener('change', function () {
          setProModeEnabled(proToggle.checked);
        });
      }

      if (proCollapseToggle) {
        proCollapseToggle.addEventListener('click', function () {
          if (!proModeEnabled) {
            return;
          }
          setProCardCollapsedState(!proCardCollapsed);
        });
      }

      [
        profitMarginInput,
        hourlyRateInput,
        setupMinutesInput,
        finishingMinutesInput,
        fixedCostInput,
        discountPercentInput,
        errorRateInput,
        packagingCostInput,
        shippingCostInput,
        machinePurchaseInput,
        machineLifetimeInput
      ].forEach(function (input) {
        attachRecalcListeners(input);
      });

      attachRecalcListeners(machineHourlyInput, {
        onInput: function () {
          if (!machineHourlyProgrammatic) {
            var valueRaw = machineHourlyInput.value != null ? machineHourlyInput.value.toString().trim() : '';
            machineHourlyUserEdited = valueRaw.length > 0;
          }
        },
        onChange: function () {
          if (!machineHourlyProgrammatic) {
            var valueRaw = machineHourlyInput.value != null ? machineHourlyInput.value.toString().trim() : '';
            machineHourlyUserEdited = valueRaw.length > 0;
          }
        }
      });
      attachRecalcListeners(materialDensityInput, {
        onInput: function () {
          if (!materialDensityProgrammatic) {
            var valueRaw = materialDensityInput.value != null ? materialDensityInput.value.toString().trim() : '';
            materialDensityUserEdited = valueRaw.length > 0;
          }
          updateMaterialSuggestionState(currentMaterialDefaults);
        },
        onChange: function () {
          if (!materialDensityProgrammatic) {
            var valueRaw = materialDensityInput.value != null ? materialDensityInput.value.toString().trim() : '';
            materialDensityUserEdited = valueRaw.length > 0;
          }
          updateMaterialSuggestionState(currentMaterialDefaults);
        }
      });

      if (proPrintMinutesInput) {
        ['input', 'change', 'blur'].forEach(function (eventName) {
          proPrintMinutesInput.addEventListener(eventName, updateTimeFromProMinutes);
        });
      }

      updatePrintTimestamp();
      window.addEventListener('beforeprint', function () {
        updatePrintTimestamp();
        recalc();
      });

      window.addEventListener('afterprint', function () {
        setPrintAttribute(null);
        if (pendingPrintTitle !== null) {
          document.title = originalDocumentTitle;
          pendingPrintTitle = null;
        }
      });

      document.addEventListener('DOMContentLoaded', function () {
        recalc();
      }, { once: true });

      setMaterialDefaults();
      updateModeVisibility();
    })();
  </script>
</body>
</html>
