<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interner Bild-Konverter für Druck und Web: Formate anpassen, optimieren und ZIP-Download direkt im Browser.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.warenschmiede.com/tools/buero/doku-light/bildgenerator.html">
    <title>Pro Bild Konverter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JSZip für den Download als Archiv -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver für das Speichern -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
        }

        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%233B82F6FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }

            .drop-zone.dragover {
                background-color: #1e293b;
                transform: scale(1.01);
            }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #64748b;
            }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-5xl bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700">

        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                    <i class="ph ph-arrows-left-right text-3xl"></i> Pro Bild Konverter
                </h1>
                <p class="text-blue-100 text-sm mt-1">Konvertieren, Komprimieren & Skalieren  Lokal im Browser</p>
            </div>
            <div class="hidden sm:block text-right">
                <span class="text-xs bg-white/20 px-2 py-1 rounded text-white">Version 2.0</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 h-full lg:h-[700px]">

            <!-- Left Sidebar: Settings -->
            <div class="lg:col-span-1 bg-slate-800 p-6 border-b lg:border-b-0 lg:border-r border-slate-700 flex flex-col gap-6 overflow-y-auto">

                <!-- Format Settings -->
                <div class="space-y-3">
                    <label class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Ziel-Format</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setFormat('image/jpeg', 'jpg')" class="format-btn active bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg text-sm font-medium transition-colors" data-format="jpg">JPG</button>
                        <button onclick="setFormat('image/png', 'png')" class="format-btn bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 rounded-lg text-sm font-medium transition-colors" data-format="png">PNG</button>
                        <button onclick="setFormat('image/webp', 'webp')" class="format-btn bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 rounded-lg text-sm font-medium transition-colors" data-format="webp">WEBP</button>
                    </div>
                </div>

                <!-- Quality Slider -->
                <div class="space-y-3" id="quality-container">
                    <div class="flex justify-between">
                        <label class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Qualität</label>
                        <span id="quality-value" class="text-sm font-mono text-blue-400">90%</span>
                    </div>
                    <input type="range" id="quality" min="10" max="100" value="90" class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    <p class="text-xs text-slate-500">Niedrigere Qualität = Kleinere Dateigröße (nur JPG/WEBP).</p>
                </div>

                <!-- Resize Settings -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Größe ändern</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="resize-toggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>

                    <div id="resize-options" class="hidden space-y-2 pt-2 transition-all">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="ph ph-arrows-out-line-horizontal text-slate-400"></i>
                            </div>
                            <input type="number" id="max-width" placeholder="Max Breite (px)" class="bg-slate-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 placeholder-slate-400">
                        </div>
                        <p class="text-xs text-slate-500">Seitenverhältnis wird beibehalten.</p>
                    </div>
                </div>

                <div class="mt-auto pt-6 border-t border-slate-700">
                    <button onclick="processAll()" id="convert-btn" disabled class="w-full bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all flex justify-center items-center gap-2">
                        <i class="ph ph-play-circle text-xl"></i>
                        <span>Alle Konvertieren</span>
                    </button>
                    <button onclick="downloadAllZip()" id="zip-btn" class="hidden w-full mt-3 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all flex justify-center items-center gap-2">
                        <i class="ph ph-download-simple text-xl"></i>
                        <span>Als ZIP herunterladen</span>
                    </button>
                </div>

            </div>

            <!-- Right Content: Dropzone & List -->
            <div class="lg:col-span-2 bg-slate-900/50 p-6 flex flex-col h-full relative">

                <!-- Drop Zone -->
                <div id="drop-zone" class="drop-zone w-full h-48 rounded-2xl flex flex-col justify-center items-center cursor-pointer mb-6 group hover:bg-slate-800/50 transition-colors relative">
                    <input type="file" id="file-input" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                    <div class="text-center z-0 pointer-events-none">
                        <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="ph ph-cloud-arrow-up text-3xl text-blue-400"></i>
                        </div>
                        <p class="text-lg text-slate-300 font-medium">Bilder hier ablegen</p>
                        <p class="text-sm text-slate-500 mt-1">oder klicken zum Auswählen</p>
                    </div>
                </div>

                <!-- File List Header -->
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-slate-400 text-sm font-semibold uppercase tracking-wider">Warteschlange <span id="file-count" class="bg-slate-700 text-white px-2 py-0.5 rounded-full text-xs ml-2">0</span></h3>
                    <button onclick="clearAll()" class="text-xs text-red-400 hover:text-red-300 flex items-center gap-1">
                        <i class="ph ph-trash"></i> Alle löschen
                    </button>
                </div>

                <!-- Scrollable File List -->
                <div id="file-list" class="flex-1 overflow-y-auto space-y-3 pr-2">
                    <!-- Empty State -->
                    <div id="empty-state" class="h-full flex flex-col items-center justify-center text-slate-600 pb-10">
                        <i class="ph ph-images text-5xl mb-3 opacity-50"></i>
                        <p>Noch keine Bilder ausgewählt.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Processing Overlay (Hidden by default) -->
    <div id="processing-overlay" class="fixed inset-0 bg-slate-900/90 z-50 hidden flex flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <h2 class="text-2xl font-bold text-white">Verarbeite...</h2>
        <p class="text-slate-400 mt-2" id="progress-text">0 / 0 fertig</p>
    </div>

    <script>
        // State
        let files = [];
        let convertedFiles = [];
        let settings = {
            mimeType: 'image/jpeg',
            extension: 'jpg',
            quality: 0.9,
            resize: false,
            maxWidth: 1920
        };

        // DOM Elements
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const emptyState = document.getElementById('empty-state');
        const fileCount = document.getElementById('file-count');
        const convertBtn = document.getElementById('convert-btn');
        const zipBtn = document.getElementById('zip-btn');
        const qualitySlider = document.getElementById('quality');
        const qualityValue = document.getElementById('quality-value');
        const resizeToggle = document.getElementById('resize-toggle');
        const resizeOptions = document.getElementById('resize-options');
        const maxWidthInput = document.getElementById('max-width');
        const processingOverlay = document.getElementById('processing-overlay');
        const progressText = document.getElementById('progress-text');

        // Initial Setup
        qualitySlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            settings.quality = val / 100;
            qualityValue.textContent = val + '%';
        });

        resizeToggle.addEventListener('change', (e) => {
            settings.resize = e.target.checked;
            if (e.target.checked) {
                resizeOptions.classList.remove('hidden');
            } else {
                resizeOptions.classList.add('hidden');
            }
        });

        maxWidthInput.addEventListener('input', (e) => {
            settings.maxWidth = parseInt(e.target.value) || 1920;
        });

        // Format Selection
        function setFormat(mime, ext) {
            settings.mimeType = mime;
            settings.extension = ext;

            // Update UI
            document.querySelectorAll('.format-btn').forEach(btn => {
                if (btn.dataset.format === ext) {
                    btn.classList.remove('bg-slate-700', 'text-slate-200');
                    btn.classList.add('bg-blue-600', 'text-white');
                } else {
                    btn.classList.add('bg-slate-700', 'text-slate-200');
                    btn.classList.remove('bg-blue-600', 'text-white');
                }
            });

            // Toggle Quality Slider (PNG doesn't use quality param in toDataURL same way)
            const qualityContainer = document.getElementById('quality-container');
            if (ext === 'png') {
                qualityContainer.classList.add('opacity-50', 'pointer-events-none');
            } else {
                qualityContainer.classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        // File Handling
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            fileInput.value = ''; // Reset for re-upload
        });

        function handleFiles(newFiles) {
            const validFiles = Array.from(newFiles).filter(file => file.type.startsWith('image/'));

            if (validFiles.length === 0) return;

            files = [...files, ...validFiles];
            convertedFiles = []; // Reset previous conversions if new files added (optional logic)
            zipBtn.classList.add('hidden');
            updateUI();
        }

        function updateUI() {
            fileList.innerHTML = '';
            fileCount.textContent = files.length;
            convertBtn.disabled = files.length === 0;

            if (files.length === 0) {
                fileList.appendChild(emptyState);
                return;
            }

            files.forEach((file, index) => {
                const li = document.createElement('div');
                li.className = 'bg-slate-800 p-3 rounded-xl flex items-center gap-4 animate-[fadeIn_0.3s_ease-out]';

                // Create Thumbnail
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.className = 'w-12 h-12 object-cover rounded-lg bg-slate-700';
                img.onload = () => URL.revokeObjectURL(img.src);

                // Info
                const info = document.createElement('div');
                info.className = 'flex-1 min-w-0';
                info.innerHTML = `
                    <p class="text-sm font-medium text-white truncate">${file.name}</p>
                    <p class="text-xs text-slate-500">${(file.size / 1024).toFixed(1)} KB &bull; ${file.type.split('/')[1].toUpperCase()}</p>
                `;

                // Remove Button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'text-slate-500 hover:text-red-400 p-2 transition-colors';
                removeBtn.innerHTML = '<i class="ph ph-x"></i>';
                removeBtn.onclick = () => removeFile(index);

                li.appendChild(img);
                li.appendChild(info);
                li.appendChild(removeBtn);
                fileList.appendChild(li);
            });
        }

        function removeFile(index) {
            files.splice(index, 1);
            updateUI();
        }

        function clearAll() {
            files = [];
            convertedFiles = [];
            zipBtn.classList.add('hidden');
            updateUI();
        }

        // Conversion Logic
        async function processAll() {
            if (files.length === 0) return;

            processingOverlay.classList.remove('hidden');
            convertedFiles = [];

            for (let i = 0; i < files.length; i++) {
                progressText.textContent = `${i + 1} / ${files.length} werden verarbeitet...`;
                try {
                    const blob = await convertSingleFile(files[i]);
                    convertedFiles.push({
                        name: files[i].name.split('.')[0] + '.' + settings.extension,
                        blob: blob
                    });
                } catch (err) {
                    console.error("Fehler bei Bild:", files[i].name, err);
                }
            }

            processingOverlay.classList.add('hidden');

            // Show Success / Download options
            if (convertedFiles.length > 0) {
                zipBtn.classList.remove('hidden');
                // Trigger Zip download automatically if only 1 file? Maybe no, let user decide.
                alert(`Fertig! ${convertedFiles.length} Bilder konvertiert.`);
            }
        }

        function convertSingleFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Resize Logic
                        if (settings.resize && width > settings.maxWidth) {
                            height = Math.round(height * (settings.maxWidth / width));
                            width = settings.maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');

                        // Fill white background for Transparent PNG -> JPG conversion
                        if (settings.extension === 'jpg' || settings.extension === 'jpeg') {
                            ctx.fillStyle = '#FFFFFF';
                            ctx.fillRect(0, 0, width, height);
                        }

                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => {
                            if (blob) resolve(blob);
                            else reject(new Error('Canvas conversion failed'));
                        }, settings.mimeType, settings.quality);
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }

        // ZIP Download
        function downloadAllZip() {
            if (convertedFiles.length === 0) return;

            const zip = new JSZip();
            const folder = zip.folder("konvertierte_bilder");

            convertedFiles.forEach(file => {
                folder.file(file.name, file.blob);
            });

            zip.generateAsync({type:"blob"})
            .then(function(content) {
                saveAs(content, "bilder_konvertiert.zip");
            });
        }

        // Initialize styling
        setFormat('image/jpeg', 'jpg'); // Default
    </script>
</body>
</html>