<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marco's Banner Builder</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fabric.js für Canvas Manipulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Oswald:wght@500;700&family=Orbitron:wght@500;700&family=Bebas+Neue&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }

        .canvas-container-wrapper {
            background-image: linear-gradient(45deg, #1e293b 25%, transparent 25%), linear-gradient(-45deg, #1e293b 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #1e293b 75%), linear-gradient(-45deg, transparent 75%, #1e293b 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700 h-16 flex items-center justify-between px-6 z-10 shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i class="ph ph-paint-brush-broad text-xl text-white"></i>
            </div>
            <h1 class="font-bold text-lg text-white tracking-wide">Banner Builder <span class="text-indigo-400 text-xs font-normal align-top">PRO</span></h1>
        </div>

        <div class="flex items-center gap-3">
            <button onclick="downloadBanner()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-colors">
                <i class="ph ph-download-simple text-lg"></i> Speichern (PNG)
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 h-full overflow-hidden">

        <!-- Left Sidebar: Tools -->
        <div class="w-80 bg-slate-800 border-r border-slate-700 flex flex-col overflow-y-auto shrink-0 z-10">

            <!-- Section: Size -->
            <div class="p-5 border-b border-slate-700">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2">
                    <i class="ph ph-ruler"></i> Größe
                </h3>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <button onclick="resizeCanvas(1200, 400)" class="bg-slate-700 hover:bg-slate-600 p-2 rounded text-xs text-left transition-colors">
                        <span class="block font-bold text-white">Hero Groß</span>
                        <span class="text-slate-400">1200 x 400</span>
                    </button>
                    <button onclick="resizeCanvas(800, 200)" class="bg-slate-700 hover:bg-slate-600 p-2 rounded text-xs text-left transition-colors">
                        <span class="block font-bold text-white">Header Blog</span>
                        <span class="text-slate-400">800 x 200</span>
                    </button>
                    <button onclick="resizeCanvas(300, 250)" class="bg-slate-700 hover:bg-slate-600 p-2 rounded text-xs text-left transition-colors">
                        <span class="block font-bold text-white">Sidebar Box</span>
                        <span class="text-slate-400">300 x 250</span>
                    </button>
                    <button onclick="resizeCanvas(1080, 1080)" class="bg-slate-700 hover:bg-slate-600 p-2 rounded text-xs text-left transition-colors">
                        <span class="block font-bold text-white">Instagram/Quadrat</span>
                        <span class="text-slate-400">1080 x 1080</span>
                    </button>
                </div>
                <div class="flex gap-2 items-center text-xs">
                    <input type="number" id="custom-w" value="800" class="w-16 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-white">
                    <span class="text-slate-500">x</span>
                    <input type="number" id="custom-h" value="400" class="w-16 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-white">
                    <button onclick="applyCustomSize()" class="ml-auto text-indigo-400 hover:text-indigo-300">Setzen</button>
                </div>
            </div>

            <!-- Section: Add Objects -->
            <div class="p-5 border-b border-slate-700 space-y-3">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-1 flex items-center gap-2">
                    <i class="ph ph-plus-circle"></i> Hinzufügen
                </h3>

                <button onclick="addText()" class="w-full bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-3 rounded-lg flex items-center gap-3 transition-colors text-sm">
                    <i class="ph ph-text-t text-lg text-indigo-400"></i> Text
                </button>

                <label class="w-full bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-3 rounded-lg flex items-center gap-3 transition-colors text-sm cursor-pointer">
                    <i class="ph ph-image text-lg text-emerald-400"></i> Bild hochladen
                    <input type="file" id="img-upload" class="hidden" accept="image/*" onchange="handleImageUpload(this)">
                </label>

                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addRect()" class="bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-3 rounded-lg flex items-center justify-center gap-2 text-sm">
                        <i class="ph ph-square"></i> Box
                    </button>
                    <button onclick="addButton()" class="bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-3 rounded-lg flex items-center justify-center gap-2 text-sm">
                        <i class="ph ph-cursor-click"></i> Button
                    </button>
                </div>
            </div>

            <!-- Section: Object Properties (Dynamic) -->
            <div class="p-5 flex-1" id="properties-panel">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 flex items-center gap-2">
                    <i class="ph ph-sliders"></i> Eigenschaften
                </h3>

                <div id="no-selection" class="text-slate-500 text-sm italic text-center py-4">
                    Wähle ein Element auf der Leinwand aus.
                </div>

                <div id="selection-controls" class="hidden space-y-4">

                    <!-- Color -->
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">Farbe</label>
                        <div class="flex gap-2">
                            <input type="color" id="color-picker" class="h-8 w-full bg-transparent cursor-pointer rounded overflow-hidden" onchange="updateColor(this.value)">
                        </div>
                    </div>

                    <!-- Opacity -->
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 flex justify-between">
                            <span>Deckkraft</span> <span id="opacity-val">100%</span>
                        </label>
                        <input type="range" min="0" max="1" step="0.1" value="1" class="w-full h-1 bg-slate-600 rounded appearance-none" oninput="updateOpacity(this.value)">
                    </div>

                    <!-- Text Specific -->
                    <div id="text-controls" class="hidden space-y-4 pt-4 border-t border-slate-700">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">Schriftart</label>
                            <select id="font-family" onchange="updateFont(this.value)" class="w-full bg-slate-900 border border-slate-600 text-white text-sm rounded p-2">
                                <option value="Inter">Standard (Inter)</option>
                                <option value="Oswald">Oswald (Modern)</option>
                                <option value="Bebas Neue">Bebas (Plakat)</option>
                                <option value="Orbitron">Orbitron (Sci-Fi/Gaming)</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="toggleBold()" class="bg-slate-700 p-2 rounded hover:bg-slate-600 text-white"><i class="ph ph-text-b"></i> Fett</button>
                            <button onclick="toggleItalic()" class="bg-slate-700 p-2 rounded hover:bg-slate-600 text-white"><i class="ph ph-text-italic"></i> Kursiv</button>
                        </div>
                    </div>

                    <!-- Layering -->
                    <div class="pt-4 border-t border-slate-700 grid grid-cols-2 gap-2">
                        <button onclick="bringForward()" class="bg-slate-700 hover:bg-slate-600 text-xs p-2 rounded text-white">Ebene hoch</button>
                        <button onclick="sendBack()" class="bg-slate-700 hover:bg-slate-600 text-xs p-2 rounded text-white">Ebene runter</button>
                    </div>

                    <button onclick="deleteObject()" class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/50 py-2 rounded text-sm mt-4 transition-colors">
                        <i class="ph ph-trash"></i> Entfernen
                    </button>
                </div>
            </div>
        </div>

        <!-- Center: Canvas Area -->
        <div class="flex-1 bg-slate-900 overflow-auto flex items-center justify-center p-8 canvas-container-wrapper relative">
            <div class="shadow-2xl border border-slate-700 relative">
                <canvas id="c"></canvas>
            </div>
        </div>

    </div>

    <script>
        // Init Fabric Canvas
        const canvas = new fabric.Canvas('c', {
            backgroundColor: '#1e293b', // Slate 800 default
            preserveObjectStacking: true
        });

        // Initial Size
        resizeCanvas(800, 400);

        // --- Functions ---

        function resizeCanvas(w, h) {
            canvas.setWidth(w);
            canvas.setHeight(h);

            // Re-center logic if needed, but flexbox handles the container
            // Update custom inputs
            document.getElementById('custom-w').value = w;
            document.getElementById('custom-h').value = h;

            // Add a subtle grid line helper if needed (optional)
        }

        function applyCustomSize() {
            const w = parseInt(document.getElementById('custom-w').value);
            const h = parseInt(document.getElementById('custom-h').value);
            resizeCanvas(w, h);
        }

        // --- Adding Objects ---

        function addText() {
            const text = new fabric.IText('Dein Text', {
                left: 50,
                top: 50,
                fontFamily: 'Inter',
                fill: '#ffffff',
                fontSize: 40
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        }

        function addRect() {
            const rect = new fabric.Rect({
                left: 100,
                top: 100,
                fill: '#4f46e5', // Indigo 600
                width: 200,
                height: 100,
                rx: 10, // Rounded corners
                ry: 10
            });
            canvas.add(rect);
            canvas.setActiveObject(rect);
        }

        function addButton() {
            // Group a Rect and Text
            const rect = new fabric.Rect({
                fill: '#10b981', // Emerald 500
                width: 150,
                height: 50,
                rx: 25,
                ry: 25,
                originX: 'center',
                originY: 'center'
            });

            const text = new fabric.IText('Hier Klicken', {
                fontSize: 18,
                fontFamily: 'Inter',
                fill: '#ffffff',
                originX: 'center',
                originY: 'center'
            });

            const group = new fabric.Group([rect, text], {
                left: 150,
                top: 150
            });

            canvas.add(group);
            canvas.setActiveObject(group);
        }

        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const imgObj = new Image();
                imgObj.src = e.target.result;
                imgObj.onload = function() {
                    const imgInstance = new fabric.Image(imgObj);

                    // Scale down if huge
                    if (imgInstance.width > 500) {
                        imgInstance.scaleToWidth(400);
                    }

                    imgInstance.set({
                        left: 100,
                        top: 100
                    });

                    canvas.add(imgInstance);
                    canvas.setActiveObject(imgInstance);
                    input.value = ''; // Reset input
                }
            }
            reader.readAsDataURL(file);
        }

        // --- Editing Logic ---

        const selectionControls = document.getElementById('selection-controls');
        const noSelection = document.getElementById('no-selection');
        const colorPicker = document.getElementById('color-picker');
        const textControls = document.getElementById('text-controls');
        const opacityVal = document.getElementById('opacity-val');

        canvas.on('selection:created', updateControls);
        canvas.on('selection:updated', updateControls);
        canvas.on('selection:cleared', () => {
            selectionControls.classList.add('hidden');
            noSelection.classList.remove('hidden');
        });

        function updateControls() {
            const activeObj = canvas.getActiveObject();
            if (!activeObj) return;

            noSelection.classList.add('hidden');
            selectionControls.classList.remove('hidden');

            // Update UI values based on object
            colorPicker.value = activeObj.fill;
            opacityVal.textContent = Math.round((activeObj.opacity || 1) * 100) + '%';

            // Show text controls only for text
            if (activeObj.type === 'i-text' || activeObj.type === 'text') {
                textControls.classList.remove('hidden');
                document.getElementById('font-family').value = activeObj.fontFamily;
            } else {
                textControls.classList.add('hidden');
            }
        }

        // Property Updaters

        function updateColor(color) {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                activeObj.set('fill', color);
                // If it's a group (like our button), try to color the rect inside?
                // Simple logic for now: simple objects.
                canvas.requestRenderAll();
            }
        }

        function updateOpacity(val) {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                activeObj.set('opacity', parseFloat(val));
                opacityVal.textContent = Math.round(val * 100) + '%';
                canvas.requestRenderAll();
            }
        }

        function updateFont(font) {
            const activeObj = canvas.getActiveObject();
            if (activeObj && (activeObj.type === 'i-text' || activeObj.type === 'text')) {
                activeObj.set('fontFamily', font);
                canvas.requestRenderAll();
            }
        }

        function toggleBold() {
            const activeObj = canvas.getActiveObject();
            if (activeObj && (activeObj.type === 'i-text' || activeObj.type === 'text')) {
                activeObj.set('fontWeight', activeObj.fontWeight === 'bold' ? 'normal' : 'bold');
                canvas.requestRenderAll();
            }
        }

        function toggleItalic() {
            const activeObj = canvas.getActiveObject();
            if (activeObj && (activeObj.type === 'i-text' || activeObj.type === 'text')) {
                activeObj.set('fontStyle', activeObj.fontStyle === 'italic' ? 'normal' : 'italic');
                canvas.requestRenderAll();
            }
        }

        // Layering

        function bringForward() {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                canvas.bringForward(activeObj);
                canvas.discardActiveObject(); // deselect to refresh stack visually sometimes helps
                canvas.requestRenderAll();
            }
        }

        function sendBack() {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                canvas.sendBackwards(activeObj);
                canvas.requestRenderAll();
            }
        }

        function deleteObject() {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                canvas.remove(activeObj);
                canvas.discardActiveObject();
                canvas.requestRenderAll();
            }
        }

        // Export

        function downloadBanner() {
            // Deselect everything first so selection borders don't show up
            canvas.discardActiveObject();
            canvas.requestRenderAll();

            const link = document.createElement('a');
            link.download = 'banner_design.png';
            link.href = canvas.toDataURL({
                format: 'png',
                quality: 1
            });
            link.click();
        }

        // Add delete key listener
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Delete' || e.key === 'Backspace') {
                // Check if we are not editing text inside the text object
                const activeObj = canvas.getActiveObject();
                if (activeObj && !activeObj.isEditing) {
                    deleteObject();
                }
            }
        });

    </script>
</body>
</html>